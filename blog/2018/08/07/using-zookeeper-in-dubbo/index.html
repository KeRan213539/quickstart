<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Using Zookeeper in Dubbo</title><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en-us"><meta property="og:type" content="website"><meta property="og:site_name" content="Nacos"><meta property="og:title" content="Using Zookeeper in Dubbo"><meta property="og:url" content="/blog/2018/08/07/using-zookeeper-in-dubbo/"><meta property="og:image" content="/images/"><meta name=twitter:title content="Nacos"><meta name=twitter:url content="/blog/2018/08/07/using-zookeeper-in-dubbo/"><meta name=twitter:image content="/images/"><meta name=twitter:card content><link rel=canonical href=/blog/2018/08/07/using-zookeeper-in-dubbo/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,400italic,700" rel=stylesheet type=text/css><link rel=stylesheet href=/css/leaflet.css><link rel=stylesheet href=/css/animate.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/simple-line-icons.css><link rel=stylesheet href=/css/magnific-popup.css><link rel=stylesheet href=/css/bootstrap.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom1.css><link rel=stylesheet href=/css/custom2.css><link rel=stylesheet href=/css/font-awesome.min.css><script src=/js/modernizr-2.6.2.min.js></script><meta name=referrer content="no-referrer"><link rel="shortcut icon" href=https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png><script src=/js/jquery.min.js></script><script src=/js/jquery.easing.1.3.js></script><script src=/js/bootstrap.min.js></script><script src=/js/jquery.waypoints.min.js></script><script src=/js/jquery.stellar.min.js></script><script src=/js/jquery.countTo.js></script><script src=/js/jquery.magnific-popup.min.js></script><script src=/js/magnific-popup-options.js></script><script src=/js/main.js></script></head><body><header role=banner id=fh5co-header><div class=container><nav class="navbar navbar-default"><div class=navbar-header><a href=# class="js-fh5co-nav-toggle fh5co-nav-toggle" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar><i></i></a><a class=navbar-brand href=index.html><img id=nacosLogo src=/images/nacos.png></a></div><div id=navbar class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a class=external href=/><span>Home</span></a></li><li><a class=external href=/docs><span>Documentation</span></a></li><li class=active><a class=external href=/blog><span>Blog</span></a></li><li><a class=external href=/community><span>Community</span></a></li><li><a class=external href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0"><span>Naco In Cloud</span></a>
<img class=menu-img src=https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png></li><li><a class=external href=http://console.nacos.io/nacos/index.html><span>Demo-Console</span></a></li><li><div class=dropdown><button class="btn btn-default dropdown-toggle" type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
<span class=caret></span></button><ul class=dropdown-menu><li><a class=external href=/zh/blog/2018/08/07/%E5%9C%A8-dubbo-%E5%BA%94%E7%94%A8%E4%B8%AD%E4%BD%BF%E7%94%A8-zookeeper/>中文</a></li></ul></div></li><li><div class=navbar-nav><input type=search class="form-control nav-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><link href=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.css rel=stylesheet><script>docsearch({appId:"3CRHI0VEW6",apiKey:"e7b36bd85080f2bcfb9de34adc766043",indexName:"nacos_test",algoliaOptions:{hitsPerPage:3},inputSelector:'.nav-search-input',debug:false});</script></div></li></ul></div></nav></div></header><section class=animated><div class="col-md-2 blogDocSidebar"><a href=# id=sidebarConsoleBtn><i class="fa fa-bars fa-fw"></i></a><div id=sidebarContent><ul><li><a href=/blog/>Blog</a></li><ul><li class="collapse show" id=blog><ul><li><a class=active href=/blog/news/>Articles</a></li><ul><li class="collapse show" id=blognews><a id=m-blog20190826service-test href=/blog/2019/08/26/service-test/>Service test in dubbo admin</a>
<a id=m-blog20190811tracing-dubbo-service-with-apache-skywalking href=/blog/2019/08/11/tracing-dubbo-service-with-apache-skywalking/>Use apache skywalking in dubbo</a>
<a id=m-blog20190502dubbo-extensible-mechanism-source-code-analysis-part-2 href=/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/>Dubbo extensible mechanism - part 2</a>
<a id=m-blog20190425dubbo-extensible-mechanism-source-code-analysis-part-1 href=/blog/2019/04/25/dubbo-extensible-mechanism-source-code-analysis-part-1/>Dubbo extensible mechanism - part 1</a>
<a id=m-blog20190220implementation-background-and-practice-of-dubbo-client-asynchronous-interface href=/blog/2019/02/20/implementation-background-and-practice-of-dubbo-client-asynchronous-interface/>Dubbo Async Client</a>
<a id=m-blog20190220implementation-background-and-practice-of-dubbo-server-asynchronous-interface href=/blog/2019/02/20/implementation-background-and-practice-of-dubbo-server-asynchronous-interface/>Dubbo Async Server</a>
<a id=m-blog20190117how-to-use-seata-to-ensure-consistency-between-dubbo-microservices href=/blog/2019/01/17/how-to-use-seata-to-ensure-consistency-between-dubbo-microservices/>Use Seata in Dubbo</a>
<a id=m-blog20181210the-fifth-dubbo-meetup-has-been-held-in-hangzhou href=/blog/2018/12/10/the-fifth-dubbo-meetup-has-been-held-in-hangzhou/>The fifth Dubbo meetup</a>
<a id=m-blog20181107dubbo-integrates-with-nacos-to-become-a-registry href=/blog/2018/11/07/dubbo-integrates-with-nacos-to-become-a-registry/>Use Dubbo with Nacos</a>
<a id=m-blog20181005introduction-to-the-dubbo-protocol href=/blog/2018/10/05/introduction-to-the-dubbo-protocol/>Introduction to the Dubbo protocol</a>
<a id=m-blog20180930integrate-dubbo-with-kubernetes href=/blog/2018/09/30/integrate-dubbo-with-kubernetes/>Integrate Dubbo with Kubernetes</a>
<a id=m-blog20180902how-to-prepare-an-apache-release href=/blog/2018/09/02/how-to-prepare-an-apache-release/>How to prepare an Apache Release</a>
<a id=m-blog20180902how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo href=/blog/2018/09/02/how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo/>New Async Call</a>
<a id=m-blog20180826the-fourth-dubbo-meetup-has-been-held-in-chengdu href=/blog/2018/08/26/the-fourth-dubbo-meetup-has-been-held-in-chengdu/>The fourth Dubbo meetup</a>
<a id=m-blog20180814dubbo-basic-usage-dubbo-consumer-configuration href=/blog/2018/08/14/dubbo-basic-usage-dubbo-consumer-configuration/>Dubbo Consumer Configuration</a>
<a id=m-blog20180814dubbo-several-ways-about-synchronousasynchronous-invoke href=/blog/2018/08/14/dubbo-several-ways-about-synchronous/asynchronous-invoke/>Dubbo Invoke</a>
<a id=m-blog20180814dubbo-basic-usage-dubbo-provider-configuration href=/blog/2018/08/14/dubbo-basic-usage-dubbo-provider-configuration/>Dubbo Provider Configuration</a>
<a id=m-blog20180814manipulating-services-dynamically-via-qos href=/blog/2018/08/14/manipulating-services-dynamically-via-qos/>Dubbo QoS Introduction</a>
<a id=m-blog20180814source-code-analysis-of-spring-boot-dubbo-app-start-and-stop href=/blog/2018/08/14/source-code-analysis-of-spring-boot-dubbo-app-start-and-stop/>Dubbo start/stop in spring boot</a>
<a id=m-blog20180814implementation-of-cross-language-calls-by-dubbo2js href=/blog/2018/08/14/implementation-of-cross-language-calls-by-dubbo2.js/>dubbo2.js introduction</a>
<a id=m-blog20180814generic-invoke-of-dubbo href=/blog/2018/08/14/generic-invoke-of-dubbo/>Generic invoke</a>
<a id=m-blog20180810dubbos-load-balance href=/blog/2018/08/10/dubbos-load-balance/>Dubbo's Load Balance</a>
<a id=m-blog20180807use-annotations-in-dubbo href=/blog/2018/08/07/use-annotations-in-dubbo/>Use Annotations In Dubbo</a>
<a id=m-blog20180807using-zookeeper-in-dubbo class=active2 href=/blog/2018/08/07/using-zookeeper-in-dubbo/>Using Zookeeper in Dubbo</a>
<a id=m-blog20180807dubbo-101 href=/blog/2018/08/07/dubbo-101/>Your First Dubbo Demo</a>
<a id=m-blog20180730the-third-dubbo-meetup-has-been-held-in-shenzhen href=/blog/2018/07/30/the-third-dubbo-meetup-has-been-held-in-shenzhen/>The third Dubbo meetup</a>
<a id=m-blog20180727sentinel-the-flow-sentinel-of-dubbo-services href=/blog/2018/07/27/sentinel-the-flow-sentinel-of-dubbo-services/>Introduce sentinel</a>
<a id=m-blog20180712tracking-with-pinpoint href=/blog/2018/07/12/tracking-with-pinpoint/>Tracking with Pinpoint</a>
<a id=m-blog20180701your-first-dubbo-filter href=/blog/2018/07/01/your-first-dubbo-filter/>Your First Dubbo Filter</a>
<a id=m-blog20180623the-second-dubbo-shanghai-meetup-has-been-held-successfully href=/blog/2018/06/23/the-second-dubbo-shanghai-meetup-has-been-held-successfully/>The second Dubbo meetup</a>
<a id=m-blog20180512the-first-dubbo-meetup-has-been-held-in-beijing href=/blog/2018/05/12/the-first-dubbo-meetup-has-been-held-in-beijing/>The first Dubbo meetup</a>
<a id=m-blog20180502the-apachecon-na-schedule-has-been-announced href=/blog/2018/05/02/the-apachecon-na-schedule-has-been-announced/>ApacheCon NA</a>
<a id=m-blog20180425the-gsocgoogle-summer-of-code-2018 href=/blog/2018/04/25/the-gsocgoogle-summer-of-code-2018/>GSoC 2018</a>
<a id=m-blog20180422dubbo-roadmap-is-announced-in-qcon-beijing-2018 href=/blog/2018/04/22/dubbo-roadmap-is-announced-in-qcon-beijing-2018/>QCon Beijing 2018</a></li></ul></ul><ul><li><a href=/blog/releases/>Releases</a></li><ul><li class=collapse id=blogreleases><a id=m-blog20200518past-releases href=/blog/2020/05/18/past-releases/>Past Releases</a></li></ul></ul></li></ul></ul></div><script>$(function(){$("#sidebarConsoleBtn").click(function(){$("#sidebarContent").toggle();});});</script></div><div class="col-md-2 blogDocToc"><div class=td-page-meta><a href="https://github.com/nacos-group/nacos-group.github.io/issues/new?title=Using%20Zookeeper%20in%20Dubbo" target=_blank><i class="fa fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/alibaba/nacos/issues/new target=_blank><i class="fa fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><a href=#introduction-of-zookeeper>Introduction of Zookeeper</a><ul><li><a href=#the-basic-concept>The basic concept</a></li><li><a href=#basic-implementation>Basic Implementation</a></li></ul></li><li><a href=#using-zookeeper-in-dubbo>Using Zookeeper in Dubbo</a><ul><li><a href=#prepare-the-sample-code>Prepare the sample code</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div><div class=row><div class=col-md-2></div><div class="col-md-8 blogDocContent"><main role=main><a class="btn btn-lg rssIcon" href=/blog/news/index.xml target=_blank>RSS <i class="fa fa-rss ml-2"></i></a><div class=row><div class=col-md-2><ul></ul></div><div class=col-md-10></div></div><div class=td-content><h1>Using Zookeeper in Dubbo</h1><div class=lead>This article introduces basic concepts of Zookeeper, and how to use Zookeeper as a registry center.</div><div class="td-byline mb-4"><time datetime=2018-08-07 class=text-muted>Tuesday, August 07, 2018</time></div><h2 id=introduction-of-zookeeper>Introduction of Zookeeper</h2><h3 id=the-basic-concept>The basic concept</h3><p>In the mordern distrbuted applications, there are multiple coordination problems between nodes and nodes, including: leader election, group service, locking, configuration management, naming and synchronization. Apache Zookeeper, as its name implied, is a distributed, open-source coordination service framwork to address these demand.</p><p>In order to ensure the high performance, highly available and strictly ordered access, the performance aspects of ZooKeeper means it can be used in large, distributed systems and can also be deployed in cluster mode, which called &lsquo;ZooKeeper ensemble&rsquo;. In ZooKeeper ensemble, all write requests from clients are forwarded to a single server, called the leader, through the ZAB(Zookeeper Atomic Broadcast Protocol) to make sure the message in each nodes are same. Clients can access any one of the clusters to read and write data without worrying about inconsistencies in the data.</p><p><img src=/imgs/blog/zk-emsemble.png alt="Diagram shows client-server architecture of ZooKeeper">
<em>Image Credit : ebook -Zookeeper-Distributed Process Coordination from O&rsquo;Reilly</em></p><p>The method to store the data in Zookeeper is similar as the standard UNIX file system, as a data model styled after the familiar directory tree structure of file systems. When we talking about ZooKeeper data nodes, we call it Znodes to clarify it.</p><p><img src=/imgs/blog/zk-tree.png alt=zk-tree>
<em>Image Credit : ebook -Zookeeper-Distributed Process Coordination from O&rsquo;Reilly</em></p><h3 id=basic-implementation>Basic Implementation</h3><p>You could donwload and install Zookeeper directly<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
Or you could use Homebrew <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <code>brew install zookeeper</code> to install Zookeeper in Mac OS.
Considering the versatility, we run the Zookeeper by using docker in this blog. If you have not installed the docker yet, please prepare the docker environment first. <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><h4 id=1-running-the-zookeeper>1. Running the Zookeeper</h4><p>Execute the command to run zookeeper in a docker container</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker run --rm --name zookeeper -p 2181:2181 zookeeper
</code></pre></div><h4 id=2-entering-the-zookeeper-container>2. Entering the zookeeper container</h4><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker <span style=color:#b58900>exec</span> -it zookeeper bash
</code></pre></div><p>In the <code>bin</code> directory, there is a command to start zookeeper <code>zkServer</code> and the Management Console <code>zkCli</code></p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bash-4.4# ls -l bin
total <span style=color:#2aa198>36</span>
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe       <span style=color:#2aa198>232</span> Mar <span style=color:#2aa198>27</span> 04:32 README.txt
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>1937</span> Mar <span style=color:#2aa198>27</span> 04:32 zkCleanup.sh
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>1056</span> Mar <span style=color:#2aa198>27</span> 04:32 zkCli.cmd
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>1534</span> Mar <span style=color:#2aa198>27</span> 04:32 zkCli.sh
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>1759</span> Mar <span style=color:#2aa198>27</span> 04:32 zkEnv.cmd
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>2696</span> Mar <span style=color:#2aa198>27</span> 04:32 zkEnv.sh
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>1089</span> Mar <span style=color:#2aa198>27</span> 04:32 zkServer.cmd
-rwxr-xr-x    <span style=color:#2aa198>1</span> zookeepe zookeepe      <span style=color:#2aa198>6773</span> Mar <span style=color:#2aa198>27</span> 04:32 zkServer.sh
</code></pre></div><h4 id=3-entering-the-zookeeper-management-interface-via-zkcli>3. Entering the zookeeper management interface via zkCli</h4><p>Since it was started through docker, the process of Zookeeper has been started and will provide the services to the public via port 2181.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bash-4.4# ps
PID   USER     TIME  COMMAND
    <span style=color:#2aa198>1</span> zookeepe  0:02 /usr/lib/jvm/java-1.8-openjdk/jre/bin/java -Dzookeeper.log.dir<span style=color:#719e07>=</span>. -Dzookeeper.root
   <span style=color:#2aa198>32</span> root      0:00 bash
   <span style=color:#2aa198>42</span> root      0:00 ps
</code></pre></div><p>So, it allows you to access Zookeeper&rsquo;s console directly through <code>zkCli</code> for management.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bash-4.4# bin/zkCli.sh -server 127.0.0.1:2181
Connecting to 127.0.0.1:2181
...
WATCHER::

WatchedEvent state:SyncConnected type:None path:null

<span style=color:#719e07>[</span>zk: 127.0.0.1:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 0<span style=color:#719e07>]</span> <span style=color:#b58900>help</span>
ZooKeeper -server host:port cmd args
	stat path <span style=color:#719e07>[</span>watch<span style=color:#719e07>]</span>
	<span style=color:#b58900>set</span> path data <span style=color:#719e07>[</span>version<span style=color:#719e07>]</span>
	ls path <span style=color:#719e07>[</span>watch<span style=color:#719e07>]</span>
	delquota <span style=color:#719e07>[</span>-n|-b<span style=color:#719e07>]</span> path
	ls2 path <span style=color:#719e07>[</span>watch<span style=color:#719e07>]</span>
	setAcl path acl
	setquota -n|-b val path
	<span style=color:#b58900>history</span>
	redo cmdno
	printwatches on|off
	delete path <span style=color:#719e07>[</span>version<span style=color:#719e07>]</span>
	sync path
	listquota path
	rmr path
	get path <span style=color:#719e07>[</span>watch<span style=color:#719e07>]</span>
	create <span style=color:#719e07>[</span>-s<span style=color:#719e07>]</span> <span style=color:#719e07>[</span>-e<span style=color:#719e07>]</span> path data acl
	addauth scheme auth
	quit
	getAcl path
	close
	connect host:port
</code></pre></div><h4 id=4-basic-examples-on-zkcli>4. Basic Examples on zkCli</h4><p>Create <code>/hello-zone</code> node:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#719e07>[</span>zk: 127.0.0.1:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 19<span style=color:#719e07>]</span> create /hello-zone <span style=color:#2aa198>&#39;world&#39;</span>
Created /hello-zone
</code></pre></div><p>List the child nodes under <code>/</code> and confirm that <code>hello-zone</code> is created:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#719e07>[</span>zk: 127.0.0.1:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 20<span style=color:#719e07>]</span> ls /
<span style=color:#719e07>[</span>zookeeper, hello-zone<span style=color:#719e07>]</span>
</code></pre></div><p>List the child nodes for <code>/hello-zone</code> and verify that it is empty:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#719e07>[</span>zk: 127.0.0.1:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 21<span style=color:#719e07>]</span> ls /hello-zone
<span style=color:#719e07>[]</span>
</code></pre></div><p>Get the data stored on the <code>/hello-zone</code> node:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#719e07>[</span>zk: 127.0.0.1:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 22<span style=color:#719e07>]</span> get /hello-zone
world
</code></pre></div><h2 id=using-zookeeper-in-dubbo>Using Zookeeper in Dubbo</h2><p>Zookeeper is used for service registration discovery and configuration management in Dubbo, and the structure of data in Zookeeper is shown in the following figure:</p><p><img src=../../img/blog/dubbo-in-zk.jpg alt=dubbo-in-zk></p><p>First, all data related to Dubbo is organized under the root node of <code>/dubbo</code>.</p><p>The secondary directory is the service name like <code>com.foo.BarService</code>.</p><p>The three-level directory has two child nodes, <code>providers</code> and <code>consumers</code>, representing the supplier and customers of the service.</p><p>The URL information for each application instance associated with the service will be recorded by the Level 4 directory. The <code>providers</code> and <code>consumer</code> will stored the providers information and the consumers information of the services seperately.<br>For example, the service provider of <code>com.foo.BarService</code> will register its URL Information to <code>/dubbo/com.foo.BarService/providers</code>; Similarly, service consumers will register their information under the corresponding <code>consumer</code> node. At the same time, consumers will subscribe to the corresponding <code>providers</code> node to be able to detect the changes of the service provider address list.</p><h3 id=prepare-the-sample-code>Prepare the sample code</h3><p>The code in this document can be found in <a href=https://github.com/dubbo/dubbo-samples/tree/master/dubbo-samples-zookeeper>https://github.com/dubbo/dubbo-samples/tree/master/dubbo-samples-zookeeper</a>.</p><h4 id=1-interface-definition>1. Interface definition</h4><p>Define a simple <code>greetingservice</code> interface with only one simple method named <code>sayHello</code> to greet to the caller.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>interface</span> <span style=color:#268bd2>GreetingService</span> <span style=color:#719e07>{</span>
    String <span style=color:#268bd2>sayHello</span><span style=color:#719e07>(</span>String name<span style=color:#719e07>);</span>
<span style=color:#719e07>}</span>
</code></pre></div><h4 id=2-server-implementation>2. Server: Implementation</h4><p>Implement the <code>GreetingService</code> interface and mark it as a service for Dubbo via <code>@Service</code>.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Service</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>AnnotatedGreetingService</span> <span style=color:#268bd2>implements</span> GreetingService <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> String <span style=color:#268bd2>sayHello</span><span style=color:#719e07>(</span>String name<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        <span style=color:#719e07>return</span> <span style=color:#2aa198>&#34;hello, &#34;</span> <span style=color:#719e07>+</span> name<span style=color:#719e07>;</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><h4 id=3-server-assembly>3. Server: Assembly</h4><p>Define ProviderConfiguration to assemble Dubbo services.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Configuration</span>
<span style=color:#268bd2>@EnableDubbo</span><span style=color:#719e07>(</span>scanBasePackages <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;com.alibaba.dubbo.samples.impl&#34;</span><span style=color:#719e07>)</span>
<span style=color:#268bd2>@PropertySource</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;classpath:/spring/dubbo-provider.properties&#34;</span><span style=color:#719e07>)</span>
<span style=color:#268bd2>static</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ProviderConfiguration</span> <span style=color:#719e07>{}</span>
</code></pre></div><p>Dubbo-provider.properties is an external configuration in a spring application, as follows:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>dubbo.application.name=demo-provider
dubbo.registry.address=zookeeper://$DOCKER_HOST:2181
dubbo.protocol.name=dubbo
dubbo.protocol.port=20880
</code></pre></div><p>Since zookeeper runs in a docker container, please be noted that:</p><ul><li>We assumes that Dubbo applications is running on the host machine (outside the docker container) in this document, and needs to replace the PATH of Zookeeper with the IP address of the Environment Variable <em>${DOCKER_HOST}</em>. Please find more detail in the official Docker documentation.</li><li>When the Dubbo application is a docker application, the container&rsquo;s name is equivalent to Zookeeper&rsquo;s. The container&rsquo;s name is ** zookeeper ** in this document.</li><li>Of course, if you don&rsquo;t want to run the Zookeeper in a container mode, just simply replace <em>$DOCKER_HOST</em> with <strong>localhost</strong>.</li></ul><h4 id=4-server-starting-service>4. Server: Starting Service</h4><p>In the <code>main</code> method, you could provide the Dubbo service by running a Spring Context.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ProviderBootstrap</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> Exception <span style=color:#719e07>{</span>
        AnnotationConfigApplicationContext context <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> AnnotationConfigApplicationContext<span style=color:#719e07>(</span>ProviderConfiguration<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        context<span style=color:#719e07>.</span>start<span style=color:#719e07>();</span>
        System<span style=color:#719e07>.</span>in<span style=color:#719e07>.</span>read<span style=color:#719e07>();</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><p>Start the <code>main</code> method of server, you will get the following output, which represents the success of the server&rsquo;s startup, and the <code>GreetingService</code> service is registered on the ZookeeperRegistry:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#719e07>[</span>03/08/18 10:50:33:033 CST<span style=color:#719e07>]</span> main  INFO zookeeper.ZookeeperRegistry:  <span style=color:#719e07>[</span>DUBBO<span style=color:#719e07>]</span> Register: dubbo://192.168.99.1:20880/com.alibaba.dubbo.samples.api.GreetingService?anyhost<span style=color:#719e07>=</span>true&amp;<span style=color:#268bd2>application</span><span style=color:#719e07>=</span>demo-provider&amp;<span style=color:#268bd2>dubbo</span><span style=color:#719e07>=</span>2.6.2&amp;<span style=color:#268bd2>generic</span><span style=color:#719e07>=</span>false&amp;<span style=color:#268bd2>interface</span><span style=color:#719e07>=</span>com.alibaba.dubbo.samples.api.GreetingService&amp;<span style=color:#268bd2>methods</span><span style=color:#719e07>=</span>sayHello&amp;<span style=color:#268bd2>pid</span><span style=color:#719e07>=</span>12938&amp;<span style=color:#268bd2>side</span><span style=color:#719e07>=</span>provider&amp;<span style=color:#268bd2>timestamp</span><span style=color:#719e07>=</span>1533264631849, dubbo version: 2.6.2, current host: 192.168.99.1
</code></pre></div><p>You could find the registration information of the service provider through the Zookeeper management terminal:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ docker <span style=color:#b58900>exec</span> -it zookeeper bash
bash-4.4# bin/zkCli.sh -server localhost:218
Connecting to localhost:2181
...
Welcome to ZooKeeper!
JLine support is enabled
...
<span style=color:#719e07>[</span>zk: localhost:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 0<span style=color:#719e07>]</span> ls /dubbo/com.alibaba.dubbo.samples.api.GreetingService/providers
<span style=color:#719e07>[</span>dubbo%3A%2F%2F192.168.99.1%3A20880%2Fcom.alibaba.dubbo.samples.api.GreetingService%3Fanyhost%3Dtrue%26application%3Ddemo-provider%26dubbo%3D2.6.2%26generic%3Dfalse%26interface%3Dcom.alibaba.dubbo.samples.api.GreetingService%26methods%3DsayHello%26pid%3D12938%26side%3Dprovider%26timestamp%3D1533264631849<span style=color:#719e07>]</span>
</code></pre></div><p>You could find that the Dubbo services just registered its URL address at the <code>providers</code> node as follows:
<em>dubbo://192.168.99.1:20880/com.alibaba.dubbo.samples.api.GreetingService?anyhost=true&application=demo-provider&dubbo=2.6.2&generic=false&interface=com.alibaba.dubbo.samples.api.GreetingService&methods=sayHello&pid=12938&side=provider&timestamp=1533264631849</em></p><h4 id=5-client-reference-service>5. Client: Reference Service</h4><p>You could declare the reference service by @Reference, while it will generate a full call. The target address of the service could be queried by the Zookeeper&rsquo;s <code>provider</code> node.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Component</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;annotatedConsumer&#34;</span><span style=color:#719e07>)</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>GreetingServiceConsumer</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>@Reference</span>
    <span style=color:#268bd2>private</span> GreetingService greetingService<span style=color:#719e07>;</span>

    <span style=color:#268bd2>public</span> String <span style=color:#268bd2>doSayHello</span><span style=color:#719e07>(</span>String name<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        <span style=color:#719e07>return</span> greetingService<span style=color:#719e07>.</span>sayHello<span style=color:#719e07>(</span>name<span style=color:#719e07>);</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><h4 id=6-client-assembling>6. Client: Assembling</h4><p>Define the ConsumerConfiguration to assemble Dubbo service.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Configuration</span>
<span style=color:#268bd2>@EnableDubbo</span><span style=color:#719e07>(</span>scanBasePackages <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;com.alibaba.dubbo.samples.action&#34;</span><span style=color:#719e07>)</span>
<span style=color:#268bd2>@PropertySource</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;classpath:/spring/dubbo-consumer.properties&#34;</span><span style=color:#719e07>)</span>
<span style=color:#268bd2>@ComponentScan</span><span style=color:#719e07>(</span>value <span style=color:#719e07>=</span> <span style=color:#719e07>{</span><span style=color:#2aa198>&#34;com.alibaba.dubbo.samples.action&#34;</span><span style=color:#719e07>})</span>
<span style=color:#268bd2>static</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ConsumerConfiguration</span> <span style=color:#719e07>{}</span>
</code></pre></div><p>&ldquo;dubbo-consumer.properties&rdquo; is a method of external configuration in a Spring application, as follows:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>dubbo.application.name=demo-consumer
dubbo.registry.address=zookeeper://$DOCKER_HOST:2181
dubbo.consumer.timeout=3000
</code></pre></div><p>Same as <strong>3. Server: Assembling</strong>, You need to modify <em>$DOCKER_HOST</em> defined in <em>dubbo.registry.address</em> according to your own environment. You could find more instructions in step 3.</p><h4 id=7-client-initiating-a-remote-call>7. Client: Initiating A Remote Call</h4><p>Run <code>main</code> to initiate a remote call from a existed service provider. Dubbo first subscribes to the zookeeper service address and then selects one from the list of returned addresses to invoke the client:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ConsumerBootstrap</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ConsumerBootstrap</span> <span style=color:#719e07>{</span>

    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> IOException <span style=color:#719e07>{</span>
        AnnotationConfigApplicationContext context <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> AnnotationConfigApplicationContext<span style=color:#719e07>(</span>ConsumerConfiguration<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        context<span style=color:#719e07>.</span>start<span style=color:#719e07>();</span>
        GreetingServiceConsumer greetingServiceConsumer <span style=color:#719e07>=</span> context<span style=color:#719e07>.</span>getBean<span style=color:#719e07>(</span>GreetingServiceConsumer<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        String hello <span style=color:#719e07>=</span> greetingServiceConsumer<span style=color:#719e07>.</span>doSayHello<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;zookeeper&#34;</span><span style=color:#719e07>);</span>
        System<span style=color:#719e07>.</span>out<span style=color:#719e07>.</span>println<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;result: &#34;</span> <span style=color:#719e07>+</span> hello<span style=color:#719e07>);</span>
        System<span style=color:#719e07>.</span>in<span style=color:#719e07>.</span>read<span style=color:#719e07>();</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><p>The output are as follows:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#719e07>[</span>03/08/18 01:42:31:031 CST<span style=color:#719e07>]</span> main  INFO zookeeper.ZookeeperRegistry:  <span style=color:#719e07>[</span>DUBBO<span style=color:#719e07>]</span> Register: consumer://192.168.99.1/com.alibaba.dubbo.samples.api.GreetingService?application<span style=color:#719e07>=</span>demo-consumer&amp;<span style=color:#268bd2>category</span><span style=color:#719e07>=</span>consumers&amp;<span style=color:#268bd2>check</span><span style=color:#719e07>=</span>false&amp;default.timeout<span style=color:#719e07>=</span>3000&amp;<span style=color:#268bd2>dubbo</span><span style=color:#719e07>=</span>2.6.2&amp;<span style=color:#268bd2>interface</span><span style=color:#719e07>=</span>com.alibaba.dubbo.samples.api.GreetingService&amp;<span style=color:#268bd2>methods</span><span style=color:#719e07>=</span>sayHello&amp;<span style=color:#268bd2>pid</span><span style=color:#719e07>=</span>82406&amp;<span style=color:#268bd2>side</span><span style=color:#719e07>=</span>consumer&amp;<span style=color:#268bd2>timestamp</span><span style=color:#719e07>=</span>1533274951195, dubbo version: 2.6.2, current host: 192.168.99.1 <span style=color:#586e75>#1</span>
<span style=color:#719e07>[</span>03/08/18 01:42:31:031 CST<span style=color:#719e07>]</span> main  INFO zookeeper.ZookeeperRegistry:  <span style=color:#719e07>[</span>DUBBO<span style=color:#719e07>]</span> Subscribe: consumer://192.168.99.1/com.alibaba.dubbo.samples.api.GreetingService?application<span style=color:#719e07>=</span>demo-consumer&amp;<span style=color:#268bd2>category</span><span style=color:#719e07>=</span>providers,configurators,routers&amp;default.timeout<span style=color:#719e07>=</span>3000&amp;<span style=color:#268bd2>dubbo</span><span style=color:#719e07>=</span>2.6.2&amp;<span style=color:#268bd2>interface</span><span style=color:#719e07>=</span>com.alibaba.dubbo.samples.api.GreetingService&amp;<span style=color:#268bd2>methods</span><span style=color:#719e07>=</span>sayHello&amp;<span style=color:#268bd2>pid</span><span style=color:#719e07>=</span>82406&amp;<span style=color:#268bd2>side</span><span style=color:#719e07>=</span>consumer&amp;<span style=color:#268bd2>timestamp</span><span style=color:#719e07>=</span>1533274951195, dubbo version: 2.6.2, current host: 192.168.99.1 <span style=color:#586e75>#2</span>
...
result: hello, zookeeper
</code></pre></div><p>Description:</p><ol><li><strong>Register</strong>: consumer://192.168.99.1/&mldr;&<strong>category=consumers</strong>&： In Zookeeper, consumers could register their information and store it at the <code>consumers</code> node</li><li><strong>Subscribe</strong>: consumer://192.168.99.1/&mldr;&<strong>category=providers,configurators,routers</strong>&：Consumers subscribe <code>providers</code>, <code>configurators</code>, <code>routers</code> from Zookeepers. The <code>configurations</code> is related to the Dubbo configuration, and <code>routers</code> is related to routing rules. The providers node subscription should be noted. When a new service provider to join, due to the relationship between the subscription, the new address list will be pushed to the subscriber. So service consumers also dynamically perceive changes in address lists.</li></ol><p>You could find the registration information of the service provider through the Zookeeper management terminal:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ docker <span style=color:#b58900>exec</span> -it zookeeper bash
bash-4.4# bin/zkCli.sh -server localhost:218
Connecting to localhost:2181
...
Welcome to ZooKeeper!
JLine support is enabled
...
<span style=color:#719e07>[</span>zk: localhost:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 4<span style=color:#719e07>]</span> ls /dubbo/com.alibaba.dubbo.samples.api.GreetingService/consumers
<span style=color:#719e07>[</span>consumer%3A%2F%2F192.168.99.1%2Fcom.alibaba.dubbo.samples.api.GreetingService%3Fapplication%3Ddemo-consumer%26category%3Dconsumers%26check%3Dfalse%26default.timeout%3D3000%26dubbo%3D2.6.2%26interface%3Dcom.alibaba.dubbo.samples.api.GreetingService%26methods%3DsayHello%26pid%3D82406%26side%3Dconsumer%26timestamp%3D1533274951195<span style=color:#719e07>]</span>
</code></pre></div><p>You could see that consumers of Dubbo&rsquo;s servicehas registered its URL address at the <code>consumers</code> node:</p><p><em>consumer://192.168.99.1/com.alibaba.dubbo.samples.api.GreetingService?application=demo-consumer&category=providers,configurators,routers&default.timeout=3000&dubbo=2.6.2&interface=com.alibaba.dubbo.samples.api.GreetingService&methods=sayHello&pid=82406&side=consumer&timestamp=1533274951195</em></p><h2 id=summary>Summary</h2><p>This document focuses on how to use ZooKeeper as a registry in Dubbo. This document also mentioned that the Zookeeper could be a configuration center and a service management in Dubbo. Zookeeper is a single-node, standalone mode. However, developers always bulid a Zookeeper server cluster called * Zookeeper ensemble * in the real world.</p><p>Through this document, readers can learn:</p><ul><li>Basic concepts and applications of ZooKeeper</li><li>The function of Zookeeper in Dubbo application</li><li>Learn about Zookeeper&rsquo;s interaction through practical sample codes</li><li>The storage of service registration and consumption information of Dubbo with ZooKeeper</li></ul><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://www.apache.org/dyn/closer.cgi/zookeeper/>https://www.apache.org/dyn/closer.cgi/zookeeper/</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://brew.sh>https://brew.sh</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=https://www.docker.com/community-edition>https://www.docker.com/community-edition</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></main></div><div class=col-md-2></div></div></section><footer id=footer role=contentinfo><div class=container><img src=/images/nacos_gray.png><div class=row><div class=col-md-6><h3>Vision</h3><p>By providing an easy-to-use service infrastructure such as dynamic service
discovery, service configuration, service sharing and management and etc., Nacos help users better
construct, deliver and manage their own service platform, reuse and composite business service
faster and deliver value of business innovation more quickly so as to win market for users in the
era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div><div class=col-md-3><dl><dt>Documentation</dt><dd><a href=/en-us/docs/what-is-nacos.html target=_self>Overview</a></dd><dd><a href=/en-us/docs/quick-start.html target=_self>Quick start</a></dd><dd><a href=/en-us/docs/contributing.html target=_self>Developer guide</a></dd></dl></div><div class=col-md-3><dl><dt>Resources</dt><dd><a href=/en-us/community/index.html target=_self>Community</a></dd><dd><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target=_self>Cloud Service MSE</a></dd><dd><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target=_self>Cloud Service EDAS</a></dd><dd><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target=_self>Cloud Service AHAS</a></dd></dl></div></div><div class="col-md-12 text-center copyright"><span>© 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></body><script type=text/javascript>;(function(){$('#fh5co-header').addClass('navbar-fixed-top fh5co-animated slideInDown');$('#nacosLogo').attr("src","/images/nacos_colorful.png")}());</script></html>