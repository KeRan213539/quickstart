<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Routing Rule</title><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en-us"><meta property="og:type" content="website"><meta property="og:site_name" content="Nacos"><meta property="og:title" content="Routing Rule"><meta property="og:url" content="/docs/v2.7/user/examples/routing-rule/"><meta property="og:image" content="/images/"><meta name=twitter:title content="Nacos"><meta name=twitter:url content="/docs/v2.7/user/examples/routing-rule/"><meta name=twitter:image content="/images/"><meta name=twitter:card content><link rel=canonical href=/docs/v2.7/user/examples/routing-rule/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,400italic,700" rel=stylesheet type=text/css><link rel=stylesheet href=/css/leaflet.css><link rel=stylesheet href=/css/animate.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/simple-line-icons.css><link rel=stylesheet href=/css/magnific-popup.css><link rel=stylesheet href=/css/bootstrap.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom1.css><link rel=stylesheet href=/css/custom2.css><link rel=stylesheet href=/css/font-awesome.min.css><script src=/js/modernizr-2.6.2.min.js></script><meta name=referrer content="no-referrer"><link rel="shortcut icon" href=https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png><script src=/js/jquery.min.js></script><script src=/js/jquery.easing.1.3.js></script><script src=/js/bootstrap.min.js></script><script src=/js/jquery.waypoints.min.js></script><script src=/js/jquery.stellar.min.js></script><script src=/js/jquery.countTo.js></script><script src=/js/jquery.magnific-popup.min.js></script><script src=/js/magnific-popup-options.js></script><script src=/js/main.js></script></head><body><header role=banner id=fh5co-header><div class=container><nav class="navbar navbar-default"><div class=navbar-header><a href=# class="js-fh5co-nav-toggle fh5co-nav-toggle" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar><i></i></a><a class=navbar-brand href=index.html><img id=nacosLogo src=/images/nacos.png></a></div><div id=navbar class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a class=external href=/><span>Home</span></a></li><li class=active><a class=external href=/docs><span>Documentation</span></a></li><li><a class=external href=/blog><span>Blog</span></a></li><li><a class=external href=/community><span>Community</span></a></li><li><a class=external href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0"><span>Naco In Cloud</span></a>
<img class=menu-img src=https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png></li><li><a class=external href=http://console.nacos.io/nacos/index.html><span>Demo-Console</span></a></li><li><div class=dropdown><button class="btn btn-default dropdown-toggle" type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
<span class=caret></span></button><ul class=dropdown-menu><li><a class=external href=/zh/docs/v2.7/user/examples/routing-rule/>中文</a></li></ul></div></li><li><div class=navbar-nav><input type=search class="form-control nav-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><link href=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.css rel=stylesheet><script>docsearch({appId:"3CRHI0VEW6",apiKey:"e7b36bd85080f2bcfb9de34adc766043",indexName:"nacos_test",algoliaOptions:{hitsPerPage:3},inputSelector:'.nav-search-input',debug:false});</script></div></li></ul></div></nav></div></header><section class=animated><div class="col-md-2 blogDocSidebar"><a href=# id=sidebarConsoleBtn><i class="fa fa-bars fa-fw"></i></a><div id=sidebarContent><ul><li><a href=/docs/>Documentation</a></li><ul><li class="collapse show" id=docs><ul><li><a href=/docs/v2.7/>Dubbo 2.7</a></li><ul><li class="collapse show" id=docsv27><ul><li><a href=/docs/v2.7/user/>User</a></li><ul><li class="collapse show" id=docsv27user><ul><li><a href=/docs/v2.7/user/preface/>Preface</a></li><ul><li class=collapse id=docsv27userpreface><a id=m-docsv27userprefacebackground href=/docs/v2.7/user/preface/background/>Background</a>
<a id=m-docsv27userprefacerequirements href=/docs/v2.7/user/preface/requirements/>Requirements</a>
<a id=m-docsv27userprefacearchitecture href=/docs/v2.7/user/preface/architecture/>Architecture</a>
<a id=m-docsv27userprefaceusage href=/docs/v2.7/user/preface/usage/>Usage</a></li></ul></ul><a id=m-docsv27userquick-start href=/docs/v2.7/user/quick-start/>Quick start</a>
<a id=m-docsv27userdependencies href=/docs/v2.7/user/dependencies/>Dependencies</a>
<a id=m-docsv27usermaturity href=/docs/v2.7/user/maturity/>Maturity</a><ul><li><a href=/docs/v2.7/user/configuration/>Configuration</a></li><ul><li class=collapse id=docsv27userconfiguration><a id=m-docsv27userconfigurationxml href=/docs/v2.7/user/configuration/xml/>XML</a>
<a id=m-docsv27userconfigurationproperties href=/docs/v2.7/user/configuration/properties/>Properties</a>
<a id=m-docsv27userconfigurationapi href=/docs/v2.7/user/configuration/api/>API</a>
<a id=m-docsv27userconfigurationannotation href=/docs/v2.7/user/configuration/annotation/>Annotation</a>
<a id=m-docsv27userconfigurationconfiguration-load-process href=/docs/v2.7/user/configuration/configuration-load-process/>Loading Process</a></li></ul></ul><ul><li><a class=active href=/docs/v2.7/user/examples/>Examples</a></li><ul><li class="collapse show" id=docsv27userexamples><a id=m-docsv27userexamplespreflight-check href=/docs/v2.7/user/examples/preflight-check/>Preflight Check</a>
<a id=m-docsv27userexamplesfault-tolerent-strategy href=/docs/v2.7/user/examples/fault-tolerent-strategy/>Fault Tolerance</a>
<a id=m-docsv27userexamplesloadbalance href=/docs/v2.7/user/examples/loadbalance/>Load Balance</a>
<a id=m-docsv27userexamplesthread-model href=/docs/v2.7/user/examples/thread-model/>Thread Model</a>
<a id=m-docsv27userexamplesexplicit-target href=/docs/v2.7/user/examples/explicit-target/>Explicit Target</a>
<a id=m-docsv27userexamplessubscribe-only href=/docs/v2.7/user/examples/subscribe-only/>Subscribe Only</a>
<a id=m-docsv27userexamplesmulti-protocols href=/docs/v2.7/user/examples/multi-protocols/>Multiple Protocols</a>
<a id=m-docsv27userexamplesmulti-registry href=/docs/v2.7/user/examples/multi-registry/>Multiple Registries</a>
<a id=m-docsv27userexamplesservice-group href=/docs/v2.7/user/examples/service-group/>Service Group</a>
<a id=m-docsv27userexamplesstatic-service href=/docs/v2.7/user/examples/static-service/>Static Service</a>
<a id=m-docsv27userexamplesmulti-versions href=/docs/v2.7/user/examples/multi-versions/>Multiple Versions</a>
<a id=m-docsv27userexamplesgroup-merger href=/docs/v2.7/user/examples/group-merger/>Group Merger</a>
<a id=m-docsv27userexamplesparameter-validation href=/docs/v2.7/user/examples/parameter-validation/>Parameter Validation</a>
<a id=m-docsv27userexamplesresult-cache href=/docs/v2.7/user/examples/result-cache/>Cache Result</a>
<a id=m-docsv27userexamplesgeneric-reference href=/docs/v2.7/user/examples/generic-reference/>Generic Reference</a>
<a id=m-docsv27userexamplesgeneric-service href=/docs/v2.7/user/examples/generic-service/>Generic Service</a>
<a id=m-docsv27userexamplesecho-service href=/docs/v2.7/user/examples/echo-service/>Echo Service</a>
<a id=m-docsv27userexamplescontext href=/docs/v2.7/user/examples/context/>Context</a>
<a id=m-docsv27userexamplesattachment href=/docs/v2.7/user/examples/attachment/>Attachment</a>
<a id=m-docsv27userexamplesasync-call href=/docs/v2.7/user/examples/async-call/>Async Call</a>
<a id=m-docsv27userexamplesasync-execute-on-provider href=/docs/v2.7/user/examples/async-execute-on-provider/>Async Execution</a>
<a id=m-docsv27userexampleslocal-call href=/docs/v2.7/user/examples/local-call/>Local Call</a>
<a id=m-docsv27userexamplescallback-parameter href=/docs/v2.7/user/examples/callback-parameter/>Callback</a>
<a id=m-docsv27userexamplesevents-notify href=/docs/v2.7/user/examples/events-notify/>Event Notification</a>
<a id=m-docsv27userexampleslocal-stub href=/docs/v2.7/user/examples/local-stub/>Local Stub</a>
<a id=m-docsv27userexampleslocal-mock href=/docs/v2.7/user/examples/local-mock/>Local Mock</a>
<a id=m-docsv27userexamplesdelay-publish href=/docs/v2.7/user/examples/delay-publish/>Delay Publish</a>
<a id=m-docsv27userexamplesconcurrency-control href=/docs/v2.7/user/examples/concurrency-control/>Concurrency</a>
<a id=m-docsv27userexamplesconfig-connections href=/docs/v2.7/user/examples/config-connections/>Connection</a>
<a id=m-docsv27userexampleslazy-connect href=/docs/v2.7/user/examples/lazy-connect/>Lazy Connect</a>
<a id=m-docsv27userexamplesstickiness href=/docs/v2.7/user/examples/stickiness/>Stickiness</a>
<a id=m-docsv27userexamplestoken-authorization href=/docs/v2.7/user/examples/token-authorization/>Token Authorization</a>
<a id=m-docsv27userexamplesrouting-rule class=active2 href=/docs/v2.7/user/examples/routing-rule/>Routing Rule</a>
<a id=m-docsv27userexamplesconfig-rule href=/docs/v2.7/user/examples/config-rule/>Configure rule</a>
<a id=m-docsv27userexamplesservice-downgrade href=/docs/v2.7/user/examples/service-downgrade/>Service Downgrade</a>
<a id=m-docsv27userexamplesgraceful-shutdown href=/docs/v2.7/user/examples/graceful-shutdown/>Graceful Shutdown</a>
<a id=m-docsv27userexampleshostname-binding href=/docs/v2.7/user/examples/hostname-binding/>Hostname Binding</a>
<a id=m-docsv27userexampleslogger-strategy href=/docs/v2.7/user/examples/logger-strategy/>Logger Strategy</a>
<a id=m-docsv27userexamplesaccesslog href=/docs/v2.7/user/examples/accesslog/>Access Log</a>
<a id=m-docsv27userexamplesservice-container href=/docs/v2.7/user/examples/service-container/>Service Container</a>
<a id=m-docsv27userexamplesreference-config-cache href=/docs/v2.7/user/examples/reference-config-cache/>ReferenceConfig Cache</a>
<a id=m-docsv27userexamplesregistry-only href=/docs/v2.7/user/examples/registry-only/>Register Only</a>
<a id=m-docsv27userexamplesdistributed-transaction href=/docs/v2.7/user/examples/distributed-transaction/>Transaction</a>
<a id=m-docsv27userexamplesdump href=/docs/v2.7/user/examples/dump/>Thread Dump</a>
<a id=m-docsv27userexamplesnetty4 href=/docs/v2.7/user/examples/netty4/>Netty4</a>
<a id=m-docsv27userexamplesserialization href=/docs/v2.7/user/examples/serialization/>Serialization</a></li></ul></ul><ul><li><a href=/docs/v2.7/user/references/>References</a></li><ul><li class=collapse id=docsv27userreferences><ul><li><a href=/docs/v2.7/user/references/xml/>XML</a></li><ul><li class=collapse id=docsv27userreferencesxml><a id=m-docsv27userreferencesxmldubbo-application href=/docs/v2.7/user/references/xml/dubbo-application/>dubbo:application</a>
<a id=m-docsv27userreferencesxmldubbo-argument href=/docs/v2.7/user/references/xml/dubbo-argument/>dubbo:argument</a>
<a id=m-docsv27userreferencesxmldubbo-config-center href=/docs/v2.7/user/references/xml/dubbo-config-center/>dubbo:config-center</a>
<a id=m-docsv27userreferencesxmldubbo-consumer href=/docs/v2.7/user/references/xml/dubbo-consumer/>dubbo:consumer</a>
<a id=m-docsv27userreferencesxmldubbo-method href=/docs/v2.7/user/references/xml/dubbo-method/>dubbo:method</a>
<a id=m-docsv27userreferencesxmldubbo-module href=/docs/v2.7/user/references/xml/dubbo-module/>dubbo:module</a>
<a id=m-docsv27userreferencesxmldubbo-monitor href=/docs/v2.7/user/references/xml/dubbo-monitor/>dubbo:monitor</a>
<a id=m-docsv27userreferencesxmldubbo-parameter href=/docs/v2.7/user/references/xml/dubbo-parameter/>dubbo:parameter</a>
<a id=m-docsv27userreferencesxmldubbo-protocol href=/docs/v2.7/user/references/xml/dubbo-protocol/>dubbo:protocol</a>
<a id=m-docsv27userreferencesxmldubbo-provider href=/docs/v2.7/user/references/xml/dubbo-provider/>dubbo:provider</a>
<a id=m-docsv27userreferencesxmldubbo-reference href=/docs/v2.7/user/references/xml/dubbo-reference/>dubbo:reference</a>
<a id=m-docsv27userreferencesxmldubbo-registry href=/docs/v2.7/user/references/xml/dubbo-registry/>dubbo:registry</a>
<a id=m-docsv27userreferencesxmldubbo-service href=/docs/v2.7/user/references/xml/dubbo-service/>dubbo:service</a></li></ul></ul><ul><li><a href=/docs/v2.7/user/references/protocol/>Protocol</a></li><ul><li class=collapse id=docsv27userreferencesprotocol><a id=m-docsv27userreferencesprotocoldubbo href=/docs/v2.7/user/references/protocol/dubbo/>dubbo://</a>
<a id=m-docsv27userreferencesprotocolrest href=/docs/v2.7/user/references/protocol/rest/>rest://</a>
<a id=m-docsv27userreferencesprotocolhttp href=/docs/v2.7/user/references/protocol/http/>http://</a>
<a id=m-docsv27userreferencesprotocolhessian href=/docs/v2.7/user/references/protocol/hessian/>hessian://</a>
<a id=m-docsv27userreferencesprotocolredis href=/docs/v2.7/user/references/protocol/redis/>redis://</a>
<a id=m-docsv27userreferencesprotocolthrift href=/docs/v2.7/user/references/protocol/thrift/>thrift://</a>
<a id=m-docsv27userreferencesprotocolmemcached href=/docs/v2.7/user/references/protocol/memcached/>memcached://</a>
<a id=m-docsv27userreferencesprotocolrmi href=/docs/v2.7/user/references/protocol/rmi/>rmi://</a>
<a id=m-docsv27userreferencesprotocolwebservice href=/docs/v2.7/user/references/protocol/webservice/>webservice://</a></li></ul></ul><ul><li><a href=/docs/v2.7/user/references/registry/>Registry Server</a></li><ul><li class=collapse id=docsv27userreferencesregistry><a id=m-docsv27userreferencesregistrynacos href=/docs/v2.7/user/references/registry/nacos/>Nacos</a>
<a id=m-docsv27userreferencesregistryzookeeper href=/docs/v2.7/user/references/registry/zookeeper/>Zookeeper</a>
<a id=m-docsv27userreferencesregistrymulticast href=/docs/v2.7/user/references/registry/multicast/>Multicast</a>
<a id=m-docsv27userreferencesregistryredis href=/docs/v2.7/user/references/registry/redis/>Redis</a>
<a id=m-docsv27userreferencesregistrysimple href=/docs/v2.7/user/references/registry/simple/>Simple</a></li></ul></ul><a id=m-docsv27userreferencesmetadata href=/docs/v2.7/user/references/metadata/>Metadata</a>
<a id=m-docsv27userreferencesapi href=/docs/v2.7/user/references/api/>API</a>
<a id=m-docsv27userreferencesqos href=/docs/v2.7/user/references/qos/>Qos</a>
<a id=m-docsv27userreferencestelnet href=/docs/v2.7/user/references/telnet/>Telnet</a>
<a id=m-docsv27userreferencesmaven href=/docs/v2.7/user/references/maven/>Maven</a></li></ul></ul><a id=m-docsv27userbest-practice href=/docs/v2.7/user/best-practice/>Best practice</a>
<a id=m-docsv27userrecommend href=/docs/v2.7/user/recommend/>Recommended usage</a>
<a id=m-docsv27usercapacity-plan href=/docs/v2.7/user/capacity-plan/>Capacity plan</a>
<a id=m-docsv27userperf-test href=/docs/v2.7/user/perf-test/>Performance</a>
<a id=m-docsv27usercoveragence href=/docs/v2.7/user/coveragence/>Test coverage</a>
<a id=m-docsv27userbenchmark-tool href=/docs/v2.7/user/benchmark-tool/>Benchmark Suite</a>
<a id=m-docsv27userrest href=/docs/v2.7/user/rest/>REST support</a>
<a id=m-docsv27usersimple-monitor href=/docs/v2.7/user/simple-monitor/>Simple monitor</a><ul><li><a href=/docs/v2.7/user/languages/>Other Languages</a></li><ul><li class=collapse id=docsv27userlanguages><ul><li><a href=/docs/v2.7/user/languages/erlang/>Erlang</a></li><ul><li class=collapse id=docsv27userlanguageserlang><a id=m-docsv27userlanguageserlangquick-start href=/docs/v2.7/user/languages/erlang/quick-start/>Quick Start</a>
<a id=m-docsv27userlanguageserlangreference href=/docs/v2.7/user/languages/erlang/reference/>Consumer</a>
<a id=m-docsv27userlanguageserlangservice href=/docs/v2.7/user/languages/erlang/service/>Provider</a>
<a id=m-docsv27userlanguageserlangserialization href=/docs/v2.7/user/languages/erlang/serialization/>Protocol</a></li></ul></ul></li></ul></ul></li></ul></ul><ul><li><a href=/docs/v2.7/dev/>Developer</a></li><ul><li class=collapse id=docsv27dev><a id=m-docsv27devbuild href=/docs/v2.7/dev/build/>Build</a>
<a id=m-docsv27devdesign href=/docs/v2.7/dev/design/>Design</a>
<a id=m-docsv27devspi href=/docs/v2.7/dev/spi/>SPI</a>
<a id=m-docsv27devimplementation href=/docs/v2.7/dev/implementation/>Implementation</a><ul><li><a href=/docs/v2.7/dev/principals/>Design Principals</a></li><ul><li class=collapse id=docsv27devprincipals><a id=m-docsv27devprincipalscode-detail href=/docs/v2.7/dev/principals/code-detail/>Details</a>
<a id=m-docsv27devprincipalsconfiguration href=/docs/v2.7/dev/principals/configuration/>Configuration</a>
<a id=m-docsv27devprincipalsdummy href=/docs/v2.7/dev/principals/dummy/>Fool-proof</a>
<a id=m-docsv27devprincipalsexpansibility href=/docs/v2.7/dev/principals/expansibility/>Extensibility</a>
<a id=m-docsv27devprincipalsextension href=/docs/v2.7/dev/principals/extension/>Extension</a>
<a id=m-docsv27devprincipalsgeneral-knowledge href=/docs/v2.7/dev/principals/general-knowledge/>General Rule</a>
<a id=m-docsv27devprincipalsrobustness href=/docs/v2.7/dev/principals/robustness/>Robustness</a></li></ul></ul><ul><li><a href=/docs/v2.7/dev/impls/>SPI Impls</a></li><ul><li class=collapse id=docsv27devimpls><a id=m-docsv27devimplsprotocol href=/docs/v2.7/dev/impls/protocol/>Protocol</a>
<a id=m-docsv27devimplsfilter href=/docs/v2.7/dev/impls/filter/>Filter</a>
<a id=m-docsv27devimplsinvoker-listener href=/docs/v2.7/dev/impls/invoker-listener/>InvokerListener</a>
<a id=m-docsv27devimplsexporter-listener href=/docs/v2.7/dev/impls/exporter-listener/>ExporterListener</a>
<a id=m-docsv27devimplscluster href=/docs/v2.7/dev/impls/cluster/>Cluster</a>
<a id=m-docsv27devimplsrouter href=/docs/v2.7/dev/impls/router/>Router</a>
<a id=m-docsv27devimplsload-balance href=/docs/v2.7/dev/impls/load-balance/>LoadBalance</a>
<a id=m-docsv27devimplsmerger href=/docs/v2.7/dev/impls/merger/>Merger</a>
<a id=m-docsv27devimplsregistry href=/docs/v2.7/dev/impls/registry/>Registry</a>
<a id=m-docsv27devimplsmonitor href=/docs/v2.7/dev/impls/monitor/>Monitor</a>
<a id=m-docsv27devimplsextension-factory href=/docs/v2.7/dev/impls/extension-factory/>ExtensionFactory</a>
<a id=m-docsv27devimplsproxy-factory href=/docs/v2.7/dev/impls/proxy-factory/>ProxyFactory</a>
<a id=m-docsv27devimplscompiler href=/docs/v2.7/dev/impls/compiler/>Compiler</a>
<a id=m-docsv27devimplsconfig-center href=/docs/v2.7/dev/impls/config-center/>Config Center</a>
<a id=m-docsv27devimplsdispatcher href=/docs/v2.7/dev/impls/dispatcher/>Dispatcher</a>
<a id=m-docsv27devimplsthreadpool href=/docs/v2.7/dev/impls/threadpool/>ThreadPool</a>
<a id=m-docsv27devimplsserialize href=/docs/v2.7/dev/impls/serialize/>Serialization</a>
<a id=m-docsv27devimplsremoting href=/docs/v2.7/dev/impls/remoting/>Transporter</a>
<a id=m-docsv27devimplsexchanger href=/docs/v2.7/dev/impls/exchanger/>Exchanger</a>
<a id=m-docsv27devimplsnetworker href=/docs/v2.7/dev/impls/networker/>Networker</a>
<a id=m-docsv27devimplstelnet-handler href=/docs/v2.7/dev/impls/telnet-handler/>TelnetHandler</a>
<a id=m-docsv27devimplsstatus-checker href=/docs/v2.7/dev/impls/status-checker/>StatusChecker</a>
<a id=m-docsv27devimplscontainer href=/docs/v2.7/dev/impls/container/>Container</a>
<a id=m-docsv27devimplspage href=/docs/v2.7/dev/impls/page/>PageHandler</a>
<a id=m-docsv27devimplscache href=/docs/v2.7/dev/impls/cache/>Cache</a>
<a id=m-docsv27devimplsvalidation href=/docs/v2.7/dev/impls/validation/>Validation</a>
<a id=m-docsv27devimplslogger-adapter href=/docs/v2.7/dev/impls/logger-adapter/>LoggerAdapter</a></li></ul></ul><a id=m-docsv27devcontract href=/docs/v2.7/dev/contract/>Public Agreement</a>
<a id=m-docsv27devrelease href=/docs/v2.7/dev/release/>Versions</a>
<a id=m-docsv27devchecklist href=/docs/v2.7/dev/checklist/>Checklist</a>
<a id=m-docsv27devcode-smell href=/docs/v2.7/dev/code-smell/>Bad Smell</a>
<a id=m-docsv27devcoding href=/docs/v2.7/dev/coding/>Coding Convention</a>
<a id=m-docsv27devtck href=/docs/v2.7/dev/tck/>TCK</a></li></ul></ul><ul><li><a href=/docs/v2.7/admin/>Admin</a></li><ul><li class=collapse id=docsv27admin><ul><li><a href=/docs/v2.7/admin/ops/>Dubbo Admin</a></li><ul><li class=collapse id=docsv27adminops><a id=m-docsv27adminopsfunctions href=/docs/v2.7/admin/ops/functions/>Functions</a>
<a id=m-docsv27adminopsintroduction href=/docs/v2.7/admin/ops/introduction/>Introductions</a>
<a id=m-docsv27adminopssearch href=/docs/v2.7/admin/ops/search/>Search</a>
<a id=m-docsv27adminopstest href=/docs/v2.7/admin/ops/test/>Test</a>
<a id=m-docsv27adminopsapidocs href=/docs/v2.7/admin/ops/apidocs/>API Docs&Test</a>
<a id=m-docsv27adminopsgovernance href=/docs/v2.7/admin/ops/governance/>Governance</a>
<a id=m-docsv27adminopspinpoint href=/docs/v2.7/admin/ops/pinpoint/>Pinpoint</a>
<a id=m-docsv27adminopsskywalking href=/docs/v2.7/admin/ops/skywalking/>Skywalking</a></li></ul></ul><ul><li><a href=/docs/v2.7/admin/install/>Installation</a></li><ul><li class=collapse id=docsv27admininstall><a id=m-docsv27admininstalladmin-console href=/docs/v2.7/admin/install/admin-console/>Admin Console</a>
<a id=m-docsv27admininstallprovider-demo href=/docs/v2.7/admin/install/provider-demo/>Demo Provider</a>
<a id=m-docsv27admininstallconsumer-demo href=/docs/v2.7/admin/install/consumer-demo/>Demo Consumer</a>
<a id=m-docsv27admininstallzookeeper href=/docs/v2.7/admin/install/zookeeper/>Config Center</a>
<a id=m-docsv27admininstallredis href=/docs/v2.7/admin/install/redis/>Register Center</a>
<a id=m-docsv27admininstallmonitor-center href=/docs/v2.7/admin/install/monitor-center/>Monitor Center</a></li></ul></ul></li></ul></ul></li></ul></ul><ul><li><a href=/docs/v3.0/>Dubbo 3.0</a></li><ul><li class=collapse id=docsv30></li></ul></ul><ul><li><a href=/docs/contribution-guidelines/>Contribution Guideline</a></li><ul><li class=collapse id=docscontribution-guidelines><ul><li><a href=/docs/contribution-guidelines/contributor/>Contributor</a></li><ul><li class=collapse id=docscontribution-guidelinescontributor><a id=m-docscontribution-guidelinescontributorbecome-a-committer_dev href=/docs/contribution-guidelines/contributor/become-a-committer_dev/>How To</a>
<a id=m-docscontribution-guidelinescontributorcla-signing-guide_dev href=/docs/contribution-guidelines/contributor/cla-signing-guide_dev/>CLA</a>
<a id=m-docscontribution-guidelinescontributornew-contributor-guide_dev href=/docs/contribution-guidelines/contributor/new-contributor-guide_dev/>New Contributor</a>
<a id=m-docscontribution-guidelinescontributormailing-list-subscription-guide_dev href=/docs/contribution-guidelines/contributor/mailing-list-subscription-guide_dev/>Mailing List</a>
<a id=m-docscontribution-guidelinescontributorsoftware-donation-guide_dev href=/docs/contribution-guidelines/contributor/software-donation-guide_dev/>Donation</a>
<a id=m-docscontribution-guidelinescontributorreporting-security-issues_dev href=/docs/contribution-guidelines/contributor/reporting-security-issues_dev/>Security Issue</a>
<a id=m-docscontribution-guidelinescontributordubbo-extension-guide_dev href=/docs/contribution-guidelines/contributor/dubbo-extension-guide_dev/>Developing Extension</a>
<a id=m-docscontribution-guidelinescontributortest-coverage-guide_dev href=/docs/contribution-guidelines/contributor/test-coverage-guide_dev/>Test Coverage</a></li></ul></ul><ul><li><a href=/docs/contribution-guidelines/committer/>Committer</a></li><ul><li class=collapse id=docscontribution-guidelinescommitter><a id=m-docscontribution-guidelinescommitternew-committer-guide_dev href=/docs/contribution-guidelines/committer/new-committer-guide_dev/>Committer Guide</a>
<a id=m-docscontribution-guidelinescommitterrelease-guide_dev href=/docs/contribution-guidelines/committer/release-guide_dev/>Release Guide</a>
<a id=m-docscontribution-guidelinescommitterlabel-an-issue-guide_dev href=/docs/contribution-guidelines/committer/label-an-issue-guide_dev/>Issue Guide</a>
<a id=m-docscontribution-guidelinescommitterwebsite-guide_dev href=/docs/contribution-guidelines/committer/website-guide_dev/>Website Guide</a>
<a id=m-docscontribution-guidelinescommitterapache-dubbo-page_dev href=/docs/contribution-guidelines/committer/apache-dubbo-page_dev/>Official Page</a></li></ul></ul></li></ul></ul></li></ul></ul></div><script>$(function(){$("#sidebarConsoleBtn").click(function(){$("#sidebarContent").toggle();});});</script></div><div class="col-md-2 blogDocToc"><div class=td-page-meta><a href="https://github.com/nacos-group/nacos-group.github.io/issues/new?title=Routing%20Rule" target=_blank><i class="fa fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/alibaba/nacos/issues/new target=_blank><i class="fa fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><a href=#write-routing-rules>Write Routing Rules</a></li><li><a href=#conditional-routing-rules>Conditional routing rules</a><ul><li><a href=#rules>Rules：</a></li><li><a href=#expressions>Expressions：</a></li><li><a href=#samples>Samples</a></li></ul></li><li><a href=#script-routing-rules>Script routing rules</a></li><li><a href=#tag-routing-rules>Tag routing rules</a><ul><li><a href=#provider>Provider</a></li><li><a href=#consumer>Consumer</a></li><li><a href=#rules-1>Rules:</a></li></ul></li></ul></nav></div><div class=row><div class=col-md-2></div><div class="col-md-8 blogDocContent"><div class=row><div class=col-md-2><ul></ul></div><div class=col-md-10></div></div><div class=td-content><h1>Routing Rule</h1><div class=lead>Config routing rule in dubbo</div><div class="td-byline mb-4"><time datetime=0001-01-01 class=text-muted>Monday, January 01, 0001</time></div><p>The routing rules <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> determine the target server of one service call. It has two kinds of routing rules: conditional routing rules and script routing rules. It also support extension<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><h2 id=write-routing-rules>Write Routing Rules</h2><p>Writing routing rules to the registry is usually done by the monitoring center or the console page.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>RegistryFactory registryFactory <span style=color:#719e07>=</span> ExtensionLoader<span style=color:#719e07>.</span>getExtensionLoader<span style=color:#719e07>(</span>RegistryFactory<span style=color:#719e07>.</span>class<span style=color:#719e07>).</span>getAdaptiveExtension<span style=color:#719e07>();</span>
Registry registry <span style=color:#719e07>=</span> registryFactory<span style=color:#719e07>.</span>getRegistry<span style=color:#719e07>(</span>URL<span style=color:#719e07>.</span>valueOf<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;zookeeper://10.20.153.10:2181&#34;</span><span style=color:#719e07>));</span>
registry<span style=color:#719e07>.</span>register<span style=color:#719e07>(</span>URL<span style=color:#719e07>.</span>valueOf<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;route://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&#34;</span> <span style=color:#719e07>+</span> URL<span style=color:#719e07>.</span>encode<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;host = 10.20.153.10 =&gt; host = 10.20.153.11&#34;</span><span style=color:#719e07>)));</span>
</code></pre></div><p>其中：</p><ul><li><code>route://</code> It indicates the type of routing rules, supports routing rules and script routing rules, and can be extended. <strong>Required</strong>。</li><li><code>0.0.0.0</code> It indicates that all IP addresses are valid. If you want to take effect for only one IP address, fill in the IP address. <strong>Required</strong>。</li><li><code>com.foo.BarService</code> It indicates that the specified service is effective. <strong>Required</strong>。</li><li><code>group=foo</code> It indicates that the specified service in specified group is effective. When absent, the specified service which dosen&rsquo;t configure group is effective.</li><li><code>version=1.0</code>It indicates that the specified service in specified version is effective. When absent, the specified service which dosen&rsquo;t configure version is effective.</li><li><code>category=routers</code> It indicates that the data is a dynamic configuration type. <strong>Required</strong>。</li><li><code>dynamic=false</code> It indicates that it is persistent data. When the registrant exits, the data is still stored in the registry. <strong>Required</strong>。</li><li><code>enabled=true</code> It indicates whether this routing rules is effective. Option, and default effective.</li><li><code>force=false</code> It indicates whether it is forced to be executed when the routing result is null. If it is not enforced, the route will be automatically invalidated. Option, and default <code>false</code>.</li><li><code>runtime=false</code> It indicates whether to execute routing rules at every call. If not, the result is only pre-executed and cached when the provider&rsquo;s address list changes. It will get routing result from cache when the service is invoked. If you use parameter routing, you must to configure it as <code>true</code>. Be careful that the configuration will affect the performance. Option, and default <code>false</code>.</li><li><code>priority=1</code> The priority of the routing rules. it is used for sorting, the greater the priority, the more front execution. Option, and default <code>0</code>。</li><li><code>rule=URL.encode("host = 10.20.153.10 => host = 10.20.153.11")</code> It indicates the content of routing rule，<strong>Required</strong>。</li></ul><h2 id=conditional-routing-rules>Conditional routing rules</h2><p>Routing rules based on conditional expressions, such as：<code>host = 10.20.153.10 => host = 10.20.153.11</code></p><h3 id=rules>Rules：</h3><ul><li>The previous of <code>=></code> is matched condition for consumer. All parameters compare with URL of consumers. When the consumer meet the condition, it will continue to execute the behind filter rules for consumer.</li><li>After the <code>=></code> aims to filter the provider address list. All the parameters are compared against the provider&rsquo;s URL, and consumer get only the filtered address list at finally.</li><li>If the previous condition for consumer is empty, it means all consumers can matched. such as : <code>=> host != 10.20.153.11</code></li><li>If the filter condition for provider is empty, it means it is forbidden to visit. such as :<code>host = 10.20.153.10 =></code></li></ul><h3 id=expressions>Expressions：</h3><p>Parameter Support：</p><ul><li>Service call information, such as: method, argument etc. Parameter routing is currently not supported</li><li>URL field (On URL own), such as: protocol, host, port etc.</li><li>All parameters on the URL. such as: application, organization etc.</li></ul><p>Condition Support：</p><ul><li>Equal sign <code>=</code> indicates match. such as: <code>host = 10.20.153.10</code></li><li>Not equal sign <code>!=</code> indicates &ldquo;does not match&rdquo;. such as: <code>host != 10.20.153.10</code>.</li></ul><p>Value Support：</p><ul><li>Separate multiple values with a comma <code>,</code> . Such as：<code>host != 10.20.153.10,10.20.153.11</code></li><li>End with <code>*</code> to indicate wildcard. Such as： <code>host != 10.20.*</code></li><li>Start with <code>$</code> to indicate reference to consumer parameters. Such as: <code>host = $host</code></li></ul><h3 id=samples>Samples</h3><ol start=0><li><p>Exclude pre-release machine：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>=&gt; host != 172.22.3.91
</code></pre></div></li><li><p>Whitelist <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>register.ip != 10.20.153.10,10.20.153.11 =&gt;
</code></pre></div></li><li><p>Blacklist：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>register.ip = 10.20.153.10,10.20.153.11 =&gt;
</code></pre></div></li><li><p>Service boarding application only expose part of the machine to prevent the entire cluster hanging up:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>=&gt; host = 172.22.3.1*,172.22.3.2*
</code></pre></div></li><li><p>Additional machines for important applications：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>application != kylin =&gt; host != 172.22.3.95,172.22.3.96
</code></pre></div></li><li><p>Read and write separation：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>method = find*,list*,get*,is* =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
method != find*,list*,get*,is* =&gt; host = 172.22.3.97,172.22.3.98
</code></pre></div></li><li><p>Separation of Front and Background Application：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>application = bops =&gt; host = 172.22.3.91,172.22.3.92,172.22.3.93
application != bops =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
</code></pre></div></li><li><p>Isolate different network segments：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>host != 172.22.3.* =&gt; host != 172.22.3.*
</code></pre></div></li><li><p>Providers and consumers deployed in the same cluster, the machine only visit the local service：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>=&gt; host = $host
</code></pre></div></li></ol><h2 id=script-routing-rules>Script routing rules</h2><p>Script routing rules <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> support all scripts of JDK script engine. such as: javascript, jruby, groovy, etc. Configure the script type by <code>type=javascript</code>, the default is javascript.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>&#34;script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&#34; + URL.encode(&#34;(function route(invokers) { ... } (invokers))&#34;)
</code></pre></div><p>Routing rules that base on script engine is as follow：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>(<span style=color:#268bd2>function</span> route(invokers) {
    <span style=color:#268bd2>var</span> result <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> java.util.ArrayList(invokers.size());
    <span style=color:#719e07>for</span> (i <span style=color:#719e07>=</span> <span style=color:#2aa198>0</span>; i <span style=color:#719e07>&lt;</span> invokers.size(); i <span style=color:#719e07>++</span>) {
        <span style=color:#719e07>if</span> (<span style=color:#2aa198>&#34;10.20.153.10&#34;</span>.equals(invokers.get(i).getUrl().getHost())) {
            result.add(invokers.get(i));
        }
    }
    <span style=color:#719e07>return</span> result;
} (invokers)); <span style=color:#586e75>// Indicates that the method is executed immediately
</span></code></pre></div><h2 id=tag-routing-rules>Tag routing rules</h2><p>Tag routing rules <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> , when the application configures the <code>TagRouter</code> , a tagged dubbo invocation can intelligently route to the service provider which has the corresponding tag.</p><h3 id=provider>Provider</h3><ol><li>configure TagRouter for the application</li></ol><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=color:#268bd2>@Bean</span>
<span style=color:#268bd2>public</span> ApplicationConfig <span style=color:#268bd2>applicationConfig</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
    ApplicationConfig applicationConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ApplicationConfig<span style=color:#719e07>();</span>
    applicationConfig<span style=color:#719e07>.</span>setName<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;provider-book&#34;</span><span style=color:#719e07>);</span>
    applicationConfig<span style=color:#719e07>.</span>setQosEnable<span style=color:#719e07>(</span><span style=color:#cb4b16>false</span><span style=color:#719e07>);</span>
    <span style=color:#586e75>// instruct tag router
</span><span style=color:#586e75></span>    Map<span style=color:#719e07>&lt;</span>String<span style=color:#719e07>,</span>String<span style=color:#719e07>&gt;</span> parameters <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> HashMap<span style=color:#719e07>&lt;&gt;();</span>
    parameters<span style=color:#719e07>.</span>put<span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>ROUTER_KEY<span style=color:#719e07>,</span> <span style=color:#2aa198>&#34;tag&#34;</span><span style=color:#719e07>);</span>
    applicationConfig<span style=color:#719e07>.</span>setParameters<span style=color:#719e07>(</span>parameters<span style=color:#719e07>);</span>
    <span style=color:#719e07>return</span> applicationConfig<span style=color:#719e07>;</span>
<span style=color:#719e07>}</span>
</code></pre></div><ol start=2><li>configure specfic tag for the provider</li></ol><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Bean</span>
<span style=color:#268bd2>public</span> ProviderConfig <span style=color:#268bd2>providerConfig</span><span style=color:#719e07>(){</span>
	ProviderConfig providerConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ProviderConfig<span style=color:#719e07>();</span>
	providerConfig<span style=color:#719e07>.</span>setTag<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;red&#34;</span><span style=color:#719e07>);</span>
	<span style=color:#719e07>return</span> providerConfig<span style=color:#719e07>;</span>
<span style=color:#719e07>}</span>
</code></pre></div><p>The application which configures no tag will be considered as the default application, and these default apps will be treated as downgrades when the invocation fails to match the provider.</p><h3 id=consumer>Consumer</h3><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java>RpcContext<span style=color:#719e07>.</span>getContext<span style=color:#719e07>().</span>setAttachment<span style=color:#719e07>(</span>Constants<span style=color:#719e07>.</span>REQUEST_TAG_KEY<span style=color:#719e07>,</span><span style=color:#2aa198>&#34;red&#34;</span><span style=color:#719e07>);</span>
</code></pre></div><p>The scope of the <code>request.tag</code> is for each invocation, using the attachment to pass the request tag. Note that the value stored in the attachment will be passed continuously in a complete remote invocation, thanks to this feature, we only need to set the tag at the beginning of a invocation.</p><blockquote><p>Currently, only <strong>hardcoding</strong> is supported to set requestTag. Note that RpcContext is thread-bound, elegantly using the TagRouter feature, it is recommended to set the request tag via a servlet filter (in the web environment) or a custom dubbo SPI filter.</p></blockquote><h3 id=rules-1>Rules:</h3><ol><li><p><code>request.tag=red</code> will firstlt choose the provider which configures as <code>tag=red</code>. If there is no service corresponding to the request tag in the cluster, it will downgrade to <code>tag=null</code> provider, seen as default provider。</p></li><li><p>when <code>request.tag=null</code>, only <code>tag=null</code> provider will be matched. Even if there are services available in the cluster, the tags do not match, they cannot be called. This is different from rule 1. Tagged invocation can be downgraded to untagged services, but invocations that do not carry tags/carry other types of tags can never be accessed other tag services.</p></li></ol><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Support since <code>2.2.0</code> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Routing Rules Extension Point: <a href=/docs/dev/impls/router.html>Route Extension</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Note: A service can only have one whitelist rule, otherwise the two rules will be filtered out. <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>Note: Scripts have no sandbox constraints, can execute arbitrary code, and poses a backdoor risk. <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>Support since <code>2.7.0</code> <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=col-md-2></div></div></section><footer id=footer role=contentinfo><div class=container><img src=/images/nacos_gray.png><div class=row><div class=col-md-6><h3>Vision</h3><p>By providing an easy-to-use service infrastructure such as dynamic service
discovery, service configuration, service sharing and management and etc., Nacos help users better
construct, deliver and manage their own service platform, reuse and composite business service
faster and deliver value of business innovation more quickly so as to win market for users in the
era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div><div class=col-md-3><dl><dt>Documentation</dt><dd><a href=/en-us/docs/what-is-nacos.html target=_self>Overview</a></dd><dd><a href=/en-us/docs/quick-start.html target=_self>Quick start</a></dd><dd><a href=/en-us/docs/contributing.html target=_self>Developer guide</a></dd></dl></div><div class=col-md-3><dl><dt>Resources</dt><dd><a href=/en-us/community/index.html target=_self>Community</a></dd><dd><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target=_self>Cloud Service MSE</a></dd><dd><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target=_self>Cloud Service EDAS</a></dd><dd><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target=_self>Cloud Service AHAS</a></dd></dl></div></div><div class="col-md-12 text-center copyright"><span>© 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></body><script type=text/javascript>;(function(){$('#fh5co-header').addClass('navbar-fixed-top fh5co-animated slideInDown');$('#nacosLogo').attr("src","/images/nacos_colorful.png")}());</script></html>