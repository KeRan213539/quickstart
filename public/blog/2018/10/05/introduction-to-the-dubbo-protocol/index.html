<!DOCTYPE html>






<html lang="en">
<head>
  

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> Introduction to the Dubbo protocol</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <meta http-equiv="content-language" content="en-us" />

  

    
    
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Nacos">
    <meta property="og:title" content="Introduction to the Dubbo protocol">
    <meta property="og:url" content="/blog/2018/10/05/introduction-to-the-dubbo-protocol/">
    <meta property="og:image" content="/images/">
    <meta name="twitter:title" content="Nacos" />
    <meta name="twitter:url" content="/blog/2018/10/05/introduction-to-the-dubbo-protocol/" />
    <meta name="twitter:image" content="/images/" />
    <meta name="twitter:card" content="" />
    
    
    
    <link rel="canonical" href="/blog/2018/10/05/introduction-to-the-dubbo-protocol/"/>

    


    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,400italic,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/leaflet.css" />

    
    <link rel="stylesheet" href="/css/animate.css">
    
    <link rel="stylesheet" href="/css/icomoon.css">
    
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    
    <link rel="stylesheet" href="/css/magnific-popup.css">
    
    <link rel="stylesheet" href="/css/bootstrap.css">

    
    <link rel="stylesheet" href="/css/style.css">

    
    
    <link rel="stylesheet" href="/css/custom1.css">
    
    <link rel="stylesheet" href="/css/custom2.css">
    
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    

    
    <script src="/js/modernizr-2.6.2.min.js"></script>
    
    

  <meta name="referrer" content="no-referrer"/>
  <link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"/>
  	
	<script src="/js/jquery.min.js"></script>
	
	<script src="/js/jquery.easing.1.3.js"></script>
	
	<script src="/js/bootstrap.min.js"></script>
	
	<script src="/js/jquery.waypoints.min.js"></script>
	
	<script src="/js/jquery.stellar.min.js"></script>
	
	<script src="/js/jquery.countTo.js"></script>
	
	<script src="/js/jquery.magnific-popup.min.js"></script>
	<script src="/js/magnific-popup-options.js"></script>
	


	
	<script src="/js/main.js"></script>

</head>
<body>


    <header role="banner" id="fh5co-header">
        <div class="container">
            
            <nav class="navbar navbar-default">
                <div class="navbar-header">
                    
                    <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><i></i></a>
                    <a class="navbar-brand" href="index.html"><img id="nacosLogo" src="/images/nacos.png"></a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                  <ul class="nav navbar-nav navbar-right">
                    
                    
                    
                    <li><a class="external" href="/"><span>Home</span></a></li>
                    
                    
                    

                    

                    

                    

                    

                    
                        <li><a class="external" href="/docs"><span>Documentation</span></a></li>
                    
                        <li class="active"><a class="external" href="/blog"><span>Blog</span></a></li>
                    
                    <li>
                      

<div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false" >
		English
		<span class="caret"></span>
	</button>
	<ul class="dropdown-menu">
		
		<li><a class="external" href="/zh/blog/2018/10/05/dubbo-%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/">中文</a></li>
		
	</ul>
</div>
                    </li>
                </ul>
            </div>
        </nav>
        
    </div>
</header>

<section class="animated">
  <div class="col-md-2 blogDocSidebar">
    




<a href="#" id="sidebarConsoleBtn"><i class="fa fa-bars fa-fw"></i></a>
<div id="sidebarContent">
  
  






<ul>
  <li>
    <a href="/blog/" >Blog</a>
  </li>
  <ul>
    <li class="collapse show" id="blog">
      
      
      
      
        
          






<ul>
  <li>
    <a class="active" href="/blog/news/" >Articles</a>
  </li>
  <ul>
    <li class="collapse show" id="blognews">
      
      
      
      
        
          
          
          <a id="m-blog20190826service-test" href="/blog/2019/08/26/service-test/">Service test in dubbo admin</a>
        
      
      
      
        
          
          
          <a id="m-blog20190811tracing-dubbo-service-with-apache-skywalking" href="/blog/2019/08/11/tracing-dubbo-service-with-apache-skywalking/">Use apache skywalking in dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20190502dubbo-extensible-mechanism-source-code-analysis-part-2" href="/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/">Dubbo extensible mechanism - part 2</a>
        
      
      
      
        
          
          
          <a id="m-blog20190425dubbo-extensible-mechanism-source-code-analysis-part-1" href="/blog/2019/04/25/dubbo-extensible-mechanism-source-code-analysis-part-1/">Dubbo extensible mechanism - part 1</a>
        
      
      
      
        
          
          
          <a id="m-blog20190220implementation-background-and-practice-of-dubbo-client-asynchronous-interface" href="/blog/2019/02/20/implementation-background-and-practice-of-dubbo-client-asynchronous-interface/">Dubbo Async Client</a>
        
      
      
      
        
          
          
          <a id="m-blog20190220implementation-background-and-practice-of-dubbo-server-asynchronous-interface" href="/blog/2019/02/20/implementation-background-and-practice-of-dubbo-server-asynchronous-interface/">Dubbo Async Server</a>
        
      
      
      
        
          
          
          <a id="m-blog20190117how-to-use-seata-to-ensure-consistency-between-dubbo-microservices" href="/blog/2019/01/17/how-to-use-seata-to-ensure-consistency-between-dubbo-microservices/">Use Seata in Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20181210the-fifth-dubbo-meetup-has-been-held-in-hangzhou" href="/blog/2018/12/10/the-fifth-dubbo-meetup-has-been-held-in-hangzhou/">The fifth Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20181107dubbo-integrates-with-nacos-to-become-a-registry" href="/blog/2018/11/07/dubbo-integrates-with-nacos-to-become-a-registry/">Use Dubbo with Nacos</a>
        
      
      
      
        
          
          
          <a id="m-blog20181005introduction-to-the-dubbo-protocol" class="active2" href="/blog/2018/10/05/introduction-to-the-dubbo-protocol/">Introduction to the Dubbo protocol</a>
        
      
      
      
        
          
          
          <a id="m-blog20180930integrate-dubbo-with-kubernetes" href="/blog/2018/09/30/integrate-dubbo-with-kubernetes/">Integrate Dubbo with Kubernetes</a>
        
      
      
      
        
          
          
          <a id="m-blog20180902how-to-prepare-an-apache-release" href="/blog/2018/09/02/how-to-prepare-an-apache-release/">How to prepare an Apache Release</a>
        
      
      
      
        
          
          
          <a id="m-blog20180902how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo" href="/blog/2018/09/02/how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo/">New Async Call</a>
        
      
      
      
        
          
          
          <a id="m-blog20180826the-fourth-dubbo-meetup-has-been-held-in-chengdu" href="/blog/2018/08/26/the-fourth-dubbo-meetup-has-been-held-in-chengdu/">The fourth Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814dubbo-basic-usage-dubbo-consumer-configuration" href="/blog/2018/08/14/dubbo-basic-usage-dubbo-consumer-configuration/">Dubbo Consumer Configuration</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814dubbo-several-ways-about-synchronousasynchronous-invoke" href="/blog/2018/08/14/dubbo-several-ways-about-synchronous/asynchronous-invoke/">Dubbo Invoke</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814dubbo-basic-usage-dubbo-provider-configuration" href="/blog/2018/08/14/dubbo-basic-usage-dubbo-provider-configuration/">Dubbo Provider Configuration</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814manipulating-services-dynamically-via-qos" href="/blog/2018/08/14/manipulating-services-dynamically-via-qos/">Dubbo QoS Introduction</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814source-code-analysis-of-spring-boot-dubbo-app-start-and-stop" href="/blog/2018/08/14/source-code-analysis-of-spring-boot-dubbo-app-start-and-stop/">Dubbo start/stop in spring boot</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814implementation-of-cross-language-calls-by-dubbo2js" href="/blog/2018/08/14/implementation-of-cross-language-calls-by-dubbo2.js/">dubbo2.js introduction</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814generic-invoke-of-dubbo" href="/blog/2018/08/14/generic-invoke-of-dubbo/">Generic invoke</a>
        
      
      
      
        
          
          
          <a id="m-blog20180810dubbos-load-balance" href="/blog/2018/08/10/dubbos-load-balance/">Dubbo&#39;s Load Balance</a>
        
      
      
      
        
          
          
          <a id="m-blog20180807use-annotations-in-dubbo" href="/blog/2018/08/07/use-annotations-in-dubbo/">Use Annotations In Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20180807using-zookeeper-in-dubbo" href="/blog/2018/08/07/using-zookeeper-in-dubbo/">Using Zookeeper in Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20180807dubbo-101" href="/blog/2018/08/07/dubbo-101/">Your First Dubbo Demo</a>
        
      
      
      
        
          
          
          <a id="m-blog20180730the-third-dubbo-meetup-has-been-held-in-shenzhen" href="/blog/2018/07/30/the-third-dubbo-meetup-has-been-held-in-shenzhen/">The third Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180727sentinel-the-flow-sentinel-of-dubbo-services" href="/blog/2018/07/27/sentinel-the-flow-sentinel-of-dubbo-services/">Introduce sentinel</a>
        
      
      
      
        
          
          
          <a id="m-blog20180712tracking-with-pinpoint" href="/blog/2018/07/12/tracking-with-pinpoint/">Tracking with Pinpoint</a>
        
      
      
      
        
          
          
          <a id="m-blog20180701your-first-dubbo-filter" href="/blog/2018/07/01/your-first-dubbo-filter/">Your First Dubbo Filter</a>
        
      
      
      
        
          
          
          <a id="m-blog20180623the-second-dubbo-shanghai-meetup-has-been-held-successfully" href="/blog/2018/06/23/the-second-dubbo-shanghai-meetup-has-been-held-successfully/">The second Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180512the-first-dubbo-meetup-has-been-held-in-beijing" href="/blog/2018/05/12/the-first-dubbo-meetup-has-been-held-in-beijing/">The first Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180502the-apachecon-na-schedule-has-been-announced" href="/blog/2018/05/02/the-apachecon-na-schedule-has-been-announced/">ApacheCon NA</a>
        
      
      
      
        
          
          
          <a id="m-blog20180425the-gsocgoogle-summer-of-code-2018" href="/blog/2018/04/25/the-gsocgoogle-summer-of-code-2018/">GSoC 2018</a>
        
      
      
      
        
          
          
          <a id="m-blog20180422dubbo-roadmap-is-announced-in-qcon-beijing-2018" href="/blog/2018/04/22/dubbo-roadmap-is-announced-in-qcon-beijing-2018/">QCon Beijing 2018</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/blog/releases/" >Releases</a>
  </li>
  <ul>
    <li class="collapse " id="blogreleases">
      
      
      
      
        
          
          
          <a id="m-blog20200518past-releases" href="/blog/2020/05/18/past-releases/">Past Releases</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

</div>

<script>
  $(function() {
    $("#sidebarConsoleBtn").click(function () {
      $("#sidebarContent").toggle();
    });
  });
</script>



  </div>
  <div class="col-md-2 blogDocToc">
    






<div class="td-page-meta">






<a href="https://github.com/nacos-group/nacos-group.github.io/issues/new?title=Introduction%20to%20the%20Dubbo%20protocol" target="_blank"><i class="fa fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/alibaba/nacos/issues/new" target="_blank"><i class="fa fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#the-concept-of-the-protocol">The concept of the protocol</a>
      <ul>
        <li><a href="#what-is-the-protocol">What is the protocol</a></li>
        <li><a href="#the-definition-of-codec">The definition of <code>Codec</code></a></li>
      </ul>
    </li>
    <li><a href="#common-protocol-mode">Common protocol mode</a>
      <ul>
        <li><a href="#fixed-length-protocol">Fixed-length protocol</a></li>
        <li><a href="#special-delimiter-protocol">Special delimiter protocol</a></li>
        <li><a href="#variable-length-protocolprotocol-head--payload">Variable length protocol(protocol head + payload)</a></li>
      </ul>
    </li>
    <li><a href="#the-dubbo-protocol">The Dubbo protocol</a>
      <ul>
        <li><a href="#overview-to-the-dubbo-protocol">Overview to the Dubbo protocol</a></li>
        <li><a href="#dubbo-protocol-details">Dubbo protocol details</a></li>
      </ul>
    </li>
    <li><a href="#advantages-and-disadvantages-about-the-dubbo-protocol">Advantages and disadvantages about the Dubbo protocol</a>
      <ul>
        <li><a href="#advantages">Advantages</a></li>
        <li><a href="#to-be-improved">To be improved</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>



  </div>
  <div class="row">
    <div class="col-md-2">
    </div>
    <div class="col-md-8 blogDocContent">
      <main role="main">
        <a class="btn btn-lg rssIcon" href="/blog/news/index.xml"
           target="_blank">
          RSS <i class="fa fa-rss ml-2 "></i>
        </a>
        


<div class="row">
  <div class="col-md-2">
    <ul>
      
    </ul>
  </div>
  <div class="col-md-10">
    
  </div>
</div>
<div class="td-content">
  <h1>Introduction to the Dubbo protocol</h1>
  
  <div class="lead">This article introduces the design of the Dubbo protocol.</div>
  
  <div class="td-byline mb-4">
    <time datetime="2018-10-05" class="text-muted">Friday, October 05, 2018</time>
  </div>
  
  <h2 id="the-concept-of-the-protocol">The concept of the protocol</h2>
<p>The protocol is the foundation of communication between two network entities, and data is transmitted from one entity to another in the form of a byte stream over the network. In the world of byte streams, this one-dimensional byte stream cannot be reshaped into two-dimensional or multi-dimensional data structures and domain objects without a protocol.</p>
<h3 id="what-is-the-protocol">What is the protocol</h3>
<p>The protocol is the semantics determined by both parties for the communication. For example, we design a protocol for string transmission, which allows the client to send a string and the server receives the corresponding string.</p>
<p>This protocol is quite simple, first 4-byte represent the total length of the message, followed by 1-byte represents the length of the charset, and then followed by the message payload, charset name and string body.</p>
<p>For example, Send a string <code>abc</code> encoded by <code>iso-8859-1</code> to the server end. After protocol trans-coding, the content is: <code>18 = 4 + 1 + 10 + 3|10|iso-8859-1|abc</code>, when the server receives these byte streams, it first reads 4-byte and converts it to int, in this case is 18, which is the length of message. Then continue to read the remaining 14 bytes, the remaining first byte read will be the length of the charset name, which is 10, the after 10-byte content is converted to a string, the content is <code>iso-8859-1</code>. Use this charset to construct the subsequent byte array into the string <code>new String(bytes, &quot;iso-8859-1&quot;)</code>.</p>
<p>In the previous example of a custom string transfer protocol, we have already seen the role of protocols in data transmission. Without a protocol, the data exchange cannot be completed. The following is Wikipedia&rsquo;s definition of the communication protocol.</p>
<blockquote>
<p>In telecommunication, a communication protocol is a system of rules that allow two or more entities of a communications system to transmit information via any kind of variation of a physical quantity. The protocol defines the rules syntax, semantics and synchronization of communication and possible error recovery methods. Protocols may be implemented by hardware, software, or a combination of both.</p>
</blockquote>
<p>Communication protocols need to define syntax, semantics, and communication synchronization operations. The content described here is actually a formal description of the previous custom string transfer protocol.</p>
<h3 id="the-definition-of-codec">The definition of <code>Codec</code></h3>
<p><code>org.apache.dubbo.remoting.Codec2</code> define the <strong>Codec</strong>&rsquo;s I/O processing, so the main methods are <code>encode</code> and <code>decode</code>, as defined below:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">@SPI</span>
<span style="color:#268bd2">public</span> <span style="color:#268bd2">interface</span> <span style="color:#268bd2">Codec2</span> <span style="color:#719e07">{</span>

    <span style="color:#268bd2">@Adaptive</span><span style="color:#719e07">({</span>Constants<span style="color:#719e07">.</span>CODEC_KEY<span style="color:#719e07">})</span>
    <span style="color:#dc322f">void</span> <span style="color:#268bd2">encode</span><span style="color:#719e07">(</span>Channel channel<span style="color:#719e07">,</span> ChannelBuffer buffer<span style="color:#719e07">,</span> Object message<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> IOException<span style="color:#719e07">;</span>

    <span style="color:#268bd2">@Adaptive</span><span style="color:#719e07">({</span>Constants<span style="color:#719e07">.</span>CODEC_KEY<span style="color:#719e07">})</span>
    Object <span style="color:#268bd2">decode</span><span style="color:#719e07">(</span>Channel channel<span style="color:#719e07">,</span> ChannelBuffer buffer<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> IOException<span style="color:#719e07">;</span>


    <span style="color:#268bd2">enum</span> DecodeResult <span style="color:#719e07">{</span>
        NEED_MORE_INPUT<span style="color:#719e07">,</span> SKIP_SOME_INPUT
    <span style="color:#719e07">}</span>

<span style="color:#719e07">}</span>
</code></pre></div><p><code>Codec</code> works on a protocol, <code>encode</code> method means to encode the communication object to the <code>ByteBufferWrapper</code>, and <code>decode</code> method decodes the <code>ChannelBuffer</code> read from the network into <code>Object</code>, which is the communication object.</p>
<h2 id="common-protocol-mode">Common protocol mode</h2>
<p>Protocols in application layer have three general forms: fixed-length protocol, special delimiter protocol and protocol header + payload mode. The specific contents of these forms are described below.</p>
<p>When reading data from the network in the form of a byte stream, it is necessary to determine when a meaningful transmission content ends. Moreover, the transmission of data on the network, there are sticky packets and fragment packets problem. The solution to this problem is that the protocol can accurately identify, when the sticky packets or fragment packets occurs, it can handle it correctly.</p>
<h3 id="fixed-length-protocol">Fixed-length protocol</h3>
<p>The fixed-length protocol means that the length of the protocol content is fixed. For example, the protocol byte length is 50. When 50 bytes are read from the network, the decoding operation is performed. The fixed-length protocol is more efficient when reading or writing, because the size of the data cache is basically determined, just like an array. The defect is the lack of adaptability. Taking the RPC scene as an example, it is difficult to estimate the length.</p>
<blockquote>
<p>Refer to Netty&rsquo;s <code>FixedLengthFrameDecoder</code></p>
</blockquote>
<h3 id="special-delimiter-protocol">Special delimiter protocol</h3>
<p>Compared to fixed-length protocols, if we can define a special character as the end of each protocol unit, we can communicate in a variable length, so as to balance the data transmission and efficiency, such as the delimiter \n.</p>
<p>The problem with the special delimiter method is that it think about the process of protocol transmission in a simple way. For a protocol unit, it must be read all before it can be processed. In addition, it must be prevented that the data transmitted by the user cannot be the same as the delimiter, otherwise it will be disordered.</p>
<blockquote>
<p>Refer to Netty&rsquo;s <code>DelimiterBasedFrameDecoder</code></p>
</blockquote>
<h3 id="variable-length-protocolprotocol-head--payload">Variable length protocol(protocol head + payload)</h3>
<p>Generally, it is a custom protocol, which is composed of a fixed length and a variable content. The fixed length part needs to specify the length of the variable content part.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">+————————————————+
|fixed-length    |
+————————————————+
|variable content|
+————————————————+
</code></pre></div><blockquote>
<p>Refer to Netty&rsquo;s <code>LengthFieldBasedFrameDecoder</code></p>
</blockquote>
<p>The Dubbo protocol is actually a variable length protocol, which is covered in more detail in later chapters.</p>
<h2 id="the-dubbo-protocol">The Dubbo protocol</h2>
<h3 id="overview-to-the-dubbo-protocol">Overview to the Dubbo protocol</h3>
<p>The Dubbo framework defines a proprietary RPC protocol in which the specific content of the request and response protocols is presented using a table.</p>
<p><img src="/imgs/dev/dubbo_protocol_header.png" alt="/dev-guide/images/dubbo_protocol_header.jpg"></p>
<h3 id="dubbo-protocol-details">Dubbo protocol details</h3>
<ul>
<li>
<p>Magic - Magic High &amp; Magic Low (16 bits)</p>
<p>Identify protocol version, Dubbo protocol: 0xdabb</p>
</li>
<li>
<p>Req/Res (1 bit)</p>
<p>Identify a request or response. request: 1; response: 0.</p>
</li>
<li>
<p>2 Way (1 bit)</p>
<p>Only useful when Req/Res is 1(request), identifying if you expect to return a value from the server. Set to 1 if a return value from the server is required.</p>
</li>
<li>
<p>Event (1 bit)</p>
<p>Identifies whether it is an event message, for example, a heartbeat event. Set to 1 if this is an event.</p>
</li>
<li>
<p>Serialization ID (5 bit)</p>
<p>Identifies the serialization type: for example, the value of fastjson is 6.</p>
</li>
<li>
<p>Status (8 bits)</p>
<p>Only useful when Req/Res is 0 (response), used to identify the status of the response</p>
<ul>
<li>20 - OK</li>
<li>30 - CLIENT_TIMEOUT</li>
<li>31 - SERVER_TIMEOUT</li>
<li>40 - BAD_REQUEST</li>
<li>50 - BAD_RESPONSE</li>
<li>60 - SERVICE_NOT_FOUND</li>
<li>70 - SERVICE_ERROR</li>
<li>80 - SERVER_ERROR</li>
<li>90 - CLIENT_ERROR</li>
<li>100 - SERVER_THREADPOOL_EXHAUSTED_ERROR</li>
</ul>
</li>
<li>
<p>Request ID (64 bits)</p>
<p>Identifies the only request, the type is long.</p>
</li>
<li>
<p>Data Length (32 bits)</p>
<p>The length of the serialized content (variable part), counted in bytes, the type is int.</p>
</li>
<li>
<p>Variable Part</p>
<p>After being serialized by a specific serialization type (identified by the serialization ID), each part is a byte [] or byte.</p>
<ul>
<li>If it is a request packet (Req/Res = 1), each part is:
<ul>
<li>Dubbo version</li>
<li>Service name</li>
<li>Service version</li>
<li>Method name</li>
<li>Method parameter types</li>
<li>Method arguments</li>
<li>Attachments</li>
</ul>
</li>
<li>If it is a response packet (Req/Res = 0), each part is:
<ul>
<li>Return value&rsquo;s type (byte), identifying the type of value returned from the server:
<ul>
<li>Return null: RESPONSE_NULL_VALUE 2</li>
<li>Normal response value: RESPONSE_VALUE  1</li>
<li>Exception: RESPONSE_WITH_EXCEPTION  0</li>
</ul>
</li>
<li>Return value: response bytes returned from the server</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> For the variable part, when uses json serialization in current version of Dubbo framework, an additional line break is added as a separator between each part of the content. Please add a new line break after each part of the variable part, such as:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Dubbo version bytes (line break)
Service name bytes  (line break)
...
</code></pre></div><h2 id="advantages-and-disadvantages-about-the-dubbo-protocol">Advantages and disadvantages about the Dubbo protocol</h2>
<h3 id="advantages">Advantages</h3>
<ul>
<li>The protocol is designed to be very compact. The data type can be represented by 1 bit will not be represented by a byte, such as a boolean type identifier.</li>
<li>The request header is the same as response header, and the specific content is assembled to the variable part through the serializer, and it is simple to implement.</li>
</ul>
<h3 id="to-be-improved">To be improved</h3>
<ul>
<li>
<p>Similar to the http request, the header can determine the resource to be accessed, and Dubbo needs to involve the specific serializer to resolve the service name, method, method signature, and these resource locators are string type or string array. It&rsquo;s easy to convert to bytes, so it can be assembled into the header. Similar to http2 header compression, resources called for rpc can also be negotiated with an int to identify, which improves performance. This is easier to implement if the resource locator is assembled on <code>header</code>.</p>
</li>
<li>
<p>Use req/res to determine if it is a request, then you can refine the protocol, remove some unwanted identifiers and add some specific identifiers. For example, <code>status</code>, <code>twoWay</code> can be strictly customized to remove redundant identifiers. There is also a timeout identifier that is transmitted as the <code>attachment</code> of the Dubbo. In theory, it should be placed in the header of the request protocol, because the timeout is essential in the network request. Referring to <code>attachment</code>, you can see from the implementation that there are some fields in <code>attachment</code> that are duplicated with existing fields in <code>content</code>, such as <code>path</code> and <code>version</code>, which increase the protocol size.</p>
</li>
<li>
<p>Dubbo will convert the service name <code>com.alibaba.middleware.hsf.guide.api.param.ModifyOrderPriceParam</code> to <code>Lcom/alibaba/middleware/hsf/guide/api/param/ModifyOrderPriceParam;</code>, which is theoretically unnecessary, simply append a <code>;</code> will be fine.</p>
</li>
<li>
<p>The Dubbo protocol does not reserve extension fields, and cannot add new identifiers. The scalability is not very good. For example, the only way to add the <code>response context</code> function is to change the protocol version, but this requires both the client and server versions to be upgraded. Very unfriendly in distributed scenarios.</p>
</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>This article mainly introduces the concept of the protocol and the commonly used protocol mode. Then it analyzes the Dubbo protocol in detail and also mentions some shortcomings. However, compared with its simplicity and ease of implementation, the above shortcomings are not enough to drive us to redesign a new version of the protocol, so we welcome suggestions and features for protocol optimization.</p>

  
  
</div>


      </main>
    </div>
    <div class="col-md-2">
    </div>
  </div>
  
</section>

  

<footer id="footer" role="contentinfo">
  <div class="container">
    <img src="/images/nacos_gray.png"/>
    <div class="row">
      <div class="col-md-6"><h3>Vision</h3>
        <p>By providing an easy-to-use service infrastructure such as dynamic service
            discovery, service configuration, service sharing and management and etc., Nacos help users better
            construct, deliver and manage their own service platform, reuse and composite business service
            faster and deliver value of business innovation more quickly so as to win market for users in the
            era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div>
      <div class="col-md-3">
        <dl>
          <dt>Documentation</dt>
          
          <dd><a href="/en-us/docs/what-is-nacos.html" target="_self">Overview</a></dd>
          
          <dd><a href="/en-us/docs/quick-start.html" target="_self">Quick start</a></dd>
          
          <dd><a href="/en-us/docs/contributing.html" target="_self">Developer guide</a></dd>
          
        </dl>
      </div>
      <div class="col-md-3">
        <dl>
          <dt>Resources</dt>
          
          <dd><a href="/en-us/community/index.html" target="_self">Community</a></dd>
          
          <dd><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_self">Cloud Service MSE</a></dd>
          
          <dd><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self">Cloud Service EDAS</a></dd>
          
          <dd><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target="_self">Cloud Service AHAS</a></dd>
          
        </dl>
      </div>
    </div>
    <div class="col-md-12 text-center copyright">
      <span>© 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span>
    </div>
  </div>
</footer>


</body>
<script type="text/javascript">
  ;(function () {
    $('#fh5co-header').addClass('navbar-fixed-top fh5co-animated slideInDown');
    $('#nacosLogo').attr("src", "/images/nacos_colorful.png")
  }());
</script>
</html>