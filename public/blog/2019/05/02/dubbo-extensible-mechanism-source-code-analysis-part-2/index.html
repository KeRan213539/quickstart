<!DOCTYPE html>






<html lang="en">
<head>
  

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> Dubbo extensible mechanism source code analysis - part 2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <meta http-equiv="content-language" content="en-us" />

  

    
    
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Nacos">
    <meta property="og:title" content="Dubbo extensible mechanism source code analysis - part 2">
    <meta property="og:url" content="/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/">
    <meta property="og:image" content="/images/">
    <meta name="twitter:title" content="Nacos" />
    <meta name="twitter:url" content="/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/" />
    <meta name="twitter:image" content="/images/" />
    <meta name="twitter:card" content="" />
    
    
    
    <link rel="canonical" href="/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/"/>

    


    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,400italic,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/leaflet.css" />

    
    <link rel="stylesheet" href="/css/animate.css">
    
    <link rel="stylesheet" href="/css/icomoon.css">
    
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    
    <link rel="stylesheet" href="/css/magnific-popup.css">
    
    <link rel="stylesheet" href="/css/bootstrap.css">

    
    <link rel="stylesheet" href="/css/style.css">

    
    
    <link rel="stylesheet" href="/css/custom1.css">
    
    <link rel="stylesheet" href="/css/custom2.css">
    
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    

    
    <script src="/js/modernizr-2.6.2.min.js"></script>
    
    

  <meta name="referrer" content="no-referrer"/>
  <link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"/>
  	
	<script src="/js/jquery.min.js"></script>
	
	<script src="/js/jquery.easing.1.3.js"></script>
	
	<script src="/js/bootstrap.min.js"></script>
	
	<script src="/js/jquery.waypoints.min.js"></script>
	
	<script src="/js/jquery.stellar.min.js"></script>
	
	<script src="/js/jquery.countTo.js"></script>
	
	<script src="/js/jquery.magnific-popup.min.js"></script>
	<script src="/js/magnific-popup-options.js"></script>
	


	
	<script src="/js/main.js"></script>

</head>
<body>


    <header role="banner" id="fh5co-header">
        <div class="container">
            
            <nav class="navbar navbar-default">
                <div class="navbar-header">
                    
                    <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><i></i></a>
                    <a class="navbar-brand" href="index.html"><img id="nacosLogo" src="/images/nacos.png"></a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                  <ul class="nav navbar-nav navbar-right">
                    
                    
                    
                    <li><a class="external" href="/"><span>Home</span></a></li>
                    
                    
                    

                    

                    

                    

                    

                    
                        <li><a class="external" href="/docs"><span>Documentation</span></a></li>
                    
                        <li class="active"><a class="external" href="/blog"><span>Blog</span></a></li>
                    
                    <li>
                      

<div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false" >
		English
		<span class="caret"></span>
	</button>
	<ul class="dropdown-menu">
		
		<li><a class="external" href="/zh/blog/2019/05/02/dubbo%E5%8F%AF%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">中文</a></li>
		
	</ul>
</div>
                    </li>
                </ul>
            </div>
        </nav>
        
    </div>
</header>

<section class="animated">
  <div class="col-md-2 blogDocSidebar">
    




<a href="#" id="sidebarConsoleBtn"><i class="fa fa-bars fa-fw"></i></a>
<div id="sidebarContent">
  
  






<ul>
  <li>
    <a href="/blog/" >Blog</a>
  </li>
  <ul>
    <li class="collapse show" id="blog">
      
      
      
      
        
          






<ul>
  <li>
    <a class="active" href="/blog/news/" >Articles</a>
  </li>
  <ul>
    <li class="collapse show" id="blognews">
      
      
      
      
        
          
          
          <a id="m-blog20190826service-test" href="/blog/2019/08/26/service-test/">Service test in dubbo admin</a>
        
      
      
      
        
          
          
          <a id="m-blog20190811tracing-dubbo-service-with-apache-skywalking" href="/blog/2019/08/11/tracing-dubbo-service-with-apache-skywalking/">Use apache skywalking in dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20190502dubbo-extensible-mechanism-source-code-analysis-part-2" class="active2" href="/blog/2019/05/02/dubbo-extensible-mechanism-source-code-analysis-part-2/">Dubbo extensible mechanism - part 2</a>
        
      
      
      
        
          
          
          <a id="m-blog20190425dubbo-extensible-mechanism-source-code-analysis-part-1" href="/blog/2019/04/25/dubbo-extensible-mechanism-source-code-analysis-part-1/">Dubbo extensible mechanism - part 1</a>
        
      
      
      
        
          
          
          <a id="m-blog20190220implementation-background-and-practice-of-dubbo-client-asynchronous-interface" href="/blog/2019/02/20/implementation-background-and-practice-of-dubbo-client-asynchronous-interface/">Dubbo Async Client</a>
        
      
      
      
        
          
          
          <a id="m-blog20190220implementation-background-and-practice-of-dubbo-server-asynchronous-interface" href="/blog/2019/02/20/implementation-background-and-practice-of-dubbo-server-asynchronous-interface/">Dubbo Async Server</a>
        
      
      
      
        
          
          
          <a id="m-blog20190117how-to-use-seata-to-ensure-consistency-between-dubbo-microservices" href="/blog/2019/01/17/how-to-use-seata-to-ensure-consistency-between-dubbo-microservices/">Use Seata in Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20181210the-fifth-dubbo-meetup-has-been-held-in-hangzhou" href="/blog/2018/12/10/the-fifth-dubbo-meetup-has-been-held-in-hangzhou/">The fifth Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20181107dubbo-integrates-with-nacos-to-become-a-registry" href="/blog/2018/11/07/dubbo-integrates-with-nacos-to-become-a-registry/">Use Dubbo with Nacos</a>
        
      
      
      
        
          
          
          <a id="m-blog20181005introduction-to-the-dubbo-protocol" href="/blog/2018/10/05/introduction-to-the-dubbo-protocol/">Introduction to the Dubbo protocol</a>
        
      
      
      
        
          
          
          <a id="m-blog20180930integrate-dubbo-with-kubernetes" href="/blog/2018/09/30/integrate-dubbo-with-kubernetes/">Integrate Dubbo with Kubernetes</a>
        
      
      
      
        
          
          
          <a id="m-blog20180902how-to-prepare-an-apache-release" href="/blog/2018/09/02/how-to-prepare-an-apache-release/">How to prepare an Apache Release</a>
        
      
      
      
        
          
          
          <a id="m-blog20180902how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo" href="/blog/2018/09/02/how-to-implement-a-fully-asynchronous-calls-chain-based-on-dubbo/">New Async Call</a>
        
      
      
      
        
          
          
          <a id="m-blog20180826the-fourth-dubbo-meetup-has-been-held-in-chengdu" href="/blog/2018/08/26/the-fourth-dubbo-meetup-has-been-held-in-chengdu/">The fourth Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814dubbo-basic-usage-dubbo-consumer-configuration" href="/blog/2018/08/14/dubbo-basic-usage-dubbo-consumer-configuration/">Dubbo Consumer Configuration</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814dubbo-several-ways-about-synchronousasynchronous-invoke" href="/blog/2018/08/14/dubbo-several-ways-about-synchronous/asynchronous-invoke/">Dubbo Invoke</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814dubbo-basic-usage-dubbo-provider-configuration" href="/blog/2018/08/14/dubbo-basic-usage-dubbo-provider-configuration/">Dubbo Provider Configuration</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814manipulating-services-dynamically-via-qos" href="/blog/2018/08/14/manipulating-services-dynamically-via-qos/">Dubbo QoS Introduction</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814source-code-analysis-of-spring-boot-dubbo-app-start-and-stop" href="/blog/2018/08/14/source-code-analysis-of-spring-boot-dubbo-app-start-and-stop/">Dubbo start/stop in spring boot</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814implementation-of-cross-language-calls-by-dubbo2js" href="/blog/2018/08/14/implementation-of-cross-language-calls-by-dubbo2.js/">dubbo2.js introduction</a>
        
      
      
      
        
          
          
          <a id="m-blog20180814generic-invoke-of-dubbo" href="/blog/2018/08/14/generic-invoke-of-dubbo/">Generic invoke</a>
        
      
      
      
        
          
          
          <a id="m-blog20180810dubbos-load-balance" href="/blog/2018/08/10/dubbos-load-balance/">Dubbo&#39;s Load Balance</a>
        
      
      
      
        
          
          
          <a id="m-blog20180807use-annotations-in-dubbo" href="/blog/2018/08/07/use-annotations-in-dubbo/">Use Annotations In Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20180807using-zookeeper-in-dubbo" href="/blog/2018/08/07/using-zookeeper-in-dubbo/">Using Zookeeper in Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-blog20180807dubbo-101" href="/blog/2018/08/07/dubbo-101/">Your First Dubbo Demo</a>
        
      
      
      
        
          
          
          <a id="m-blog20180730the-third-dubbo-meetup-has-been-held-in-shenzhen" href="/blog/2018/07/30/the-third-dubbo-meetup-has-been-held-in-shenzhen/">The third Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180727sentinel-the-flow-sentinel-of-dubbo-services" href="/blog/2018/07/27/sentinel-the-flow-sentinel-of-dubbo-services/">Introduce sentinel</a>
        
      
      
      
        
          
          
          <a id="m-blog20180712tracking-with-pinpoint" href="/blog/2018/07/12/tracking-with-pinpoint/">Tracking with Pinpoint</a>
        
      
      
      
        
          
          
          <a id="m-blog20180701your-first-dubbo-filter" href="/blog/2018/07/01/your-first-dubbo-filter/">Your First Dubbo Filter</a>
        
      
      
      
        
          
          
          <a id="m-blog20180623the-second-dubbo-shanghai-meetup-has-been-held-successfully" href="/blog/2018/06/23/the-second-dubbo-shanghai-meetup-has-been-held-successfully/">The second Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180512the-first-dubbo-meetup-has-been-held-in-beijing" href="/blog/2018/05/12/the-first-dubbo-meetup-has-been-held-in-beijing/">The first Dubbo meetup</a>
        
      
      
      
        
          
          
          <a id="m-blog20180502the-apachecon-na-schedule-has-been-announced" href="/blog/2018/05/02/the-apachecon-na-schedule-has-been-announced/">ApacheCon NA</a>
        
      
      
      
        
          
          
          <a id="m-blog20180425the-gsocgoogle-summer-of-code-2018" href="/blog/2018/04/25/the-gsocgoogle-summer-of-code-2018/">GSoC 2018</a>
        
      
      
      
        
          
          
          <a id="m-blog20180422dubbo-roadmap-is-announced-in-qcon-beijing-2018" href="/blog/2018/04/22/dubbo-roadmap-is-announced-in-qcon-beijing-2018/">QCon Beijing 2018</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/blog/releases/" >Releases</a>
  </li>
  <ul>
    <li class="collapse " id="blogreleases">
      
      
      
      
        
          
          
          <a id="m-blog20200518past-releases" href="/blog/2020/05/18/past-releases/">Past Releases</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

</div>

<script>
  $(function() {
    $("#sidebarConsoleBtn").click(function () {
      $("#sidebarContent").toggle();
    });
  });
</script>



  </div>
  <div class="col-md-2 blogDocToc">
    






<div class="td-page-meta">






<a href="https://github.com/nacos-group/nacos-group.github.io/issues/new?title=Dubbo%20extensible%20mechanism%20source%20code%20analysis%20-%20part%202" target="_blank"><i class="fa fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/alibaba/nacos/issues/new" target="_blank"><i class="fa fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#extensionloader">ExtensionLoader</a></li>
    <li><a href="#auto-assembly-of-dubbo-spi-advanced-usage">Auto-assembly of Dubbo SPI advanced usage</a></li>
    <li><a href="#aop-of-dubbo-spi-advanced-usage">AOP of Dubbo SPI advanced usage</a>
      <ul>
        <li><a href="#what-is-the-wrapper-class">What is the Wrapper class</a></li>
        <li><a href="#how-to-configure-the-wrapper-class">How to configure the Wrapper class</a></li>
      </ul>
    </li>
    <li><a href="#extension-point-adaptive">Extension point adaptive</a></li>
  </ul>
</nav>



  </div>
  <div class="row">
    <div class="col-md-2">
    </div>
    <div class="col-md-8 blogDocContent">
      <main role="main">
        <a class="btn btn-lg rssIcon" href="/blog/news/index.xml"
           target="_blank">
          RSS <i class="fa fa-rss ml-2 "></i>
        </a>
        


<div class="row">
  <div class="col-md-2">
    <ul>
      
    </ul>
  </div>
  <div class="col-md-10">
    
  </div>
</div>
<div class="td-content">
  <h1>Dubbo extensible mechanism source code analysis - part 2</h1>
  
  <div class="lead">This article introduces the principles and details of Dubbo&rsquo;s SPI.</div>
  
  <div class="td-byline mb-4">
    <time datetime="2019-05-02" class="text-muted">Thursday, May 02, 2019</time>
  </div>
  
  <p>In the <a href="./introduction-to-dubbo-spi.md">actual implementation of the Dubbo extensibility mechanism</a>, we learned some concepts of the Dubbo extension mechanism, explored the implementation of LoadBalance in Dubbo, and implemented a LoadBalance on our own. Do you think Dubbo&rsquo;s extension mechanism is great? Next, we will go deep into the source code of Dubbo and see what it is.</p>
<h2 id="extensionloader">ExtensionLoader</h2>
<p><code>ExtensionLoader</code> is the core class, which is responsible for the loading and lifecycle management of extension points. Let&rsquo;s start with this class. There are many methods of Extension, and the common methods include:</p>
<ul>
<li><code>public static &lt;T&gt; ExtensionLoader&lt;T&gt; getExtensionLoader(Class&lt;T&gt; type)</code></li>
<li><code>public T getExtension(String name)</code></li>
<li><code>public T getAdaptiveExtension()</code></li>
</ul>
<p>The common usages are:</p>
<ul>
<li><code>LoadBalance lb = ExtensionLoader.getExtensionLoader(LoadBalance.class).getExtension(loadbalanceName)</code></li>
<li><code>RouterFactory routerFactory = ExtensionLoader.getExtensionLoader(RouterFactory.class).getAdaptiveExtension()</code></li>
</ul>
<p>Notice: In the source code shown below, I&rsquo;ll remove extraneous code (such as logging, exception catching, and so on) to make it easy to read and understand.</p>
<ol>
<li>getExtensionLoader
This is a static factory method that enters an extensible interface and returns an ExtensionLoader entity class for this interface. With this entity class, you can get not only a specific extension based on name, but also an adaptive extension.</li>
</ol>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> ExtensionLoader<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> <span style="color:#268bd2">getExtensionLoader</span><span style="color:#719e07">(</span>Class<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> type<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        <span style="color:#586e75">// An extension point must be an interface
</span><span style="color:#586e75"></span>        <span style="color:#719e07">if</span> <span style="color:#719e07">(!</span>type<span style="color:#719e07">.</span>isInterface<span style="color:#719e07">())</span> <span style="color:#719e07">{</span>
            <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;Extension type(&#34;</span> <span style="color:#719e07">+</span> type <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;) is not interface!&#34;</span><span style="color:#719e07">);</span>
        <span style="color:#719e07">}</span>
        <span style="color:#586e75">// @SPI annotations must be provided
</span><span style="color:#586e75"></span>        <span style="color:#719e07">if</span> <span style="color:#719e07">(!</span>withExtensionAnnotation<span style="color:#719e07">(</span>type<span style="color:#719e07">))</span> <span style="color:#719e07">{</span>
            <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;Extension type without @SPI Annotation!&#34;</span><span style="color:#719e07">);</span>
        <span style="color:#719e07">}</span>
        <span style="color:#586e75">// Get the corresponding ExtensionLoader from the cache according to the interface
</span><span style="color:#586e75"></span>        <span style="color:#586e75">// Each extension will only be loaded once
</span><span style="color:#586e75"></span>        ExtensionLoader<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> loader <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>ExtensionLoader<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;)</span> EXTENSION_LOADERS<span style="color:#719e07">.</span>get<span style="color:#719e07">(</span>type<span style="color:#719e07">);</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>loader <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            <span style="color:#586e75">// Initialize extension
</span><span style="color:#586e75"></span>            EXTENSION_LOADERS<span style="color:#719e07">.</span>putIfAbsent<span style="color:#719e07">(</span>type<span style="color:#719e07">,</span> <span style="color:#719e07">new</span> ExtensionLoader<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;(</span>type<span style="color:#719e07">));</span>
            loader <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>ExtensionLoader<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;)</span> EXTENSION_LOADERS<span style="color:#719e07">.</span>get<span style="color:#719e07">(</span>type<span style="color:#719e07">);</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">return</span> loader<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
    
<span style="color:#268bd2">private</span> <span style="color:#268bd2">ExtensionLoader</span><span style="color:#719e07">(</span>Class<span style="color:#719e07">&lt;?&gt;</span> type<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">this</span><span style="color:#719e07">.</span>type <span style="color:#719e07">=</span> type<span style="color:#719e07">;</span>
        objectFactory <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>type <span style="color:#719e07">==</span> ExtensionFactory<span style="color:#719e07">.</span>class <span style="color:#719e07">?</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">:</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>ExtensionFactory<span style="color:#719e07">.</span>class<span style="color:#719e07">).</span>getAdaptiveExtension<span style="color:#719e07">());</span>
<span style="color:#719e07">}</span>
</code></pre></div><ol start="2">
<li>getExtension</li>
</ol>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">public</span> T <span style="color:#268bd2">getExtension</span><span style="color:#719e07">(</span>String name<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        Holder<span style="color:#719e07">&lt;</span>Object<span style="color:#719e07">&gt;</span> holder <span style="color:#719e07">=</span> cachedInstances<span style="color:#719e07">.</span>get<span style="color:#719e07">(</span>name<span style="color:#719e07">);</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>holder <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            cachedInstances<span style="color:#719e07">.</span>putIfAbsent<span style="color:#719e07">(</span>name<span style="color:#719e07">,</span> <span style="color:#719e07">new</span> Holder<span style="color:#719e07">&lt;</span>Object<span style="color:#719e07">&gt;());</span>
            holder <span style="color:#719e07">=</span> cachedInstances<span style="color:#719e07">.</span>get<span style="color:#719e07">(</span>name<span style="color:#719e07">);</span>
        <span style="color:#719e07">}</span>
        Object instance <span style="color:#719e07">=</span> holder<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
        <span style="color:#586e75">// Get it from the cache. If it does not exist, create
</span><span style="color:#586e75"></span>        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>instance <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            <span style="color:#268bd2">synchronized</span> <span style="color:#719e07">(</span>holder<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                instance <span style="color:#719e07">=</span> holder<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
                <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>instance <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                    instance <span style="color:#719e07">=</span> createExtension<span style="color:#719e07">(</span>name<span style="color:#719e07">);</span>
                    holder<span style="color:#719e07">.</span>set<span style="color:#719e07">(</span>instance<span style="color:#719e07">);</span>
                <span style="color:#719e07">}</span>
            <span style="color:#719e07">}</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">return</span> <span style="color:#719e07">(</span>T<span style="color:#719e07">)</span> instance<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>Some judgments and caching have been made in the getExtension method, and the main logic is in the createExtension method. Let&rsquo;s move on to the createExtension method.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> T <span style="color:#268bd2">createExtension</span><span style="color:#719e07">(</span>String name<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        <span style="color:#586e75">// Get the extension class according to the name of extension point. For example,  for LoadBalance, get the RandomLoadBalance class according to random
</span><span style="color:#586e75"></span>        Class<span style="color:#719e07">&lt;?&gt;</span> clazz <span style="color:#719e07">=</span> getExtensionClasses<span style="color:#719e07">().</span>get<span style="color:#719e07">(</span>name<span style="color:#719e07">);</span>
        
        T instance <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>T<span style="color:#719e07">)</span> EXTENSION_INSTANCES<span style="color:#719e07">.</span>get<span style="color:#719e07">(</span>clazz<span style="color:#719e07">);</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>instance <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
              <span style="color:#586e75">// Use reflection to call newInstance to create an example of an extension class
</span><span style="color:#586e75"></span>            EXTENSION_INSTANCES<span style="color:#719e07">.</span>putIfAbsent<span style="color:#719e07">(</span>clazz<span style="color:#719e07">,</span> <span style="color:#719e07">(</span>T<span style="color:#719e07">)</span> clazz<span style="color:#719e07">.</span>newInstance<span style="color:#719e07">());</span>
            instance <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>T<span style="color:#719e07">)</span> EXTENSION_INSTANCES<span style="color:#719e07">.</span>get<span style="color:#719e07">(</span>clazz<span style="color:#719e07">);</span>
        <span style="color:#719e07">}</span>
        <span style="color:#586e75">// Make dependency injection for the extended class samples
</span><span style="color:#586e75"></span>        injectExtension<span style="color:#719e07">(</span>instance<span style="color:#719e07">);</span>
        <span style="color:#586e75">// If there is a wrapper, add the wrapper
</span><span style="color:#586e75"></span>        Set<span style="color:#719e07">&lt;</span>Class<span style="color:#719e07">&lt;?&gt;&gt;</span> wrapperClasses <span style="color:#719e07">=</span> cachedWrapperClasses<span style="color:#719e07">;</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>wrapperClasses <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">&amp;&amp;</span> <span style="color:#719e07">!</span>wrapperClasses<span style="color:#719e07">.</span>isEmpty<span style="color:#719e07">())</span> <span style="color:#719e07">{</span>
            <span style="color:#719e07">for</span> <span style="color:#719e07">(</span>Class<span style="color:#719e07">&lt;?&gt;</span> wrapperClass <span style="color:#719e07">:</span> wrapperClasses<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                instance <span style="color:#719e07">=</span> injectExtension<span style="color:#719e07">((</span>T<span style="color:#719e07">)</span> wrapperClass<span style="color:#719e07">.</span>getConstructor<span style="color:#719e07">(</span>type<span style="color:#719e07">).</span>newInstance<span style="color:#719e07">(</span>instance<span style="color:#719e07">));</span>
            <span style="color:#719e07">}</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">return</span> instance<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>The createExtension method has done the following:</p>
<ol>
<li>First, get the corresponding extension class according to name. Read the extension point configuration file from the <code>META-INF</code> folder under ClassPath.</li>
<li>Use reflection to create an instance of an extended class.</li>
<li>make dependency injection for the attributes of the extended class instance. That is, IoC.</li>
<li>If there is a wrapper, add the wrapper. That is, AOP.</li>
</ol>
<p>Let&rsquo;s focus on these four processes.</p>
<ol>
<li>Get the corresponding extension class according to name. Let’s read the code first:</li>
</ol>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> Map<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span> Class<span style="color:#719e07">&lt;?&gt;&gt;</span> getExtensionClasses<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        Map<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span> Class<span style="color:#719e07">&lt;?&gt;&gt;</span> classes <span style="color:#719e07">=</span> cachedClasses<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>classes <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            <span style="color:#268bd2">synchronized</span> <span style="color:#719e07">(</span>cachedClasses<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                classes <span style="color:#719e07">=</span> cachedClasses<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
                <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>classes <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                    classes <span style="color:#719e07">=</span> loadExtensionClasses<span style="color:#719e07">();</span>
                    cachedClasses<span style="color:#719e07">.</span>set<span style="color:#719e07">(</span>classes<span style="color:#719e07">);</span>
                <span style="color:#719e07">}</span>
            <span style="color:#719e07">}</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">return</span> classes<span style="color:#719e07">;</span>
    <span style="color:#719e07">}</span>

<span style="color:#586e75">// synchronized in getExtensionClasses
</span><span style="color:#586e75"></span><span style="color:#268bd2">private</span> Map<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span> Class<span style="color:#719e07">&lt;?&gt;&gt;</span> loadExtensionClasses<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        <span style="color:#268bd2">final</span> SPI defaultAnnotation <span style="color:#719e07">=</span> type<span style="color:#719e07">.</span>getAnnotation<span style="color:#719e07">(</span>SPI<span style="color:#719e07">.</span>class<span style="color:#719e07">);</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>defaultAnnotation <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            String value <span style="color:#719e07">=</span> defaultAnnotation<span style="color:#719e07">.</span>value<span style="color:#719e07">();</span>
            <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>value <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">&amp;&amp;</span> <span style="color:#719e07">(</span>value <span style="color:#719e07">=</span> value<span style="color:#719e07">.</span>trim<span style="color:#719e07">()).</span>length<span style="color:#719e07">()</span> <span style="color:#719e07">&gt;</span> 0<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                String<span style="color:#719e07">[]</span> names <span style="color:#719e07">=</span> NAME_SEPARATOR<span style="color:#719e07">.</span>split<span style="color:#719e07">(</span>value<span style="color:#719e07">);</span>
                <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>names<span style="color:#719e07">.</span>length <span style="color:#719e07">&gt;</span> 1<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                    <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalStateException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;more than 1 default extension name on extension &#34;</span> <span style="color:#719e07">+</span> type<span style="color:#719e07">.</span>getName<span style="color:#719e07">());</span>
                <span style="color:#719e07">}</span>
                <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>names<span style="color:#719e07">.</span>length <span style="color:#719e07">==</span> 1<span style="color:#719e07">)</span> cachedDefaultName <span style="color:#719e07">=</span> names<span style="color:#719e07">[</span>0<span style="color:#719e07">];</span>
            <span style="color:#719e07">}</span>
        <span style="color:#719e07">}</span>

        Map<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span> Class<span style="color:#719e07">&lt;?&gt;&gt;</span> extensionClasses <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> HashMap<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span> Class<span style="color:#719e07">&lt;?&gt;&gt;();</span>
        loadFile<span style="color:#719e07">(</span>extensionClasses<span style="color:#719e07">,</span> DUBBO_INTERNAL_DIRECTORY<span style="color:#719e07">);</span>
        loadFile<span style="color:#719e07">(</span>extensionClasses<span style="color:#719e07">,</span> DUBBO_DIRECTORY<span style="color:#719e07">);</span>
        loadFile<span style="color:#719e07">(</span>extensionClasses<span style="color:#719e07">,</span> SERVICES_DIRECTORY<span style="color:#719e07">);</span>
        <span style="color:#719e07">return</span> extensionClasses<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>This process is very simple. Get the extension class from the cache first, and if it does not exist, load it from the configuration file. The path of the configuration file has been mentioned before:</p>
<ul>
<li><code>META-INF/dubbo/internal</code></li>
<li><code>META-INF/dubbo</code></li>
<li><code>META-INF/services</code></li>
</ul>
<ol start="2">
<li>Use reflection to create an extended instance. This process is very simple. We can do this using <code>clazz.newInstance()</code>. The attributes of the extended instance created are all null values.</li>
<li>Extended instance is automatic assembly. In the actual scenario, there have dependencies between classes. Dependencies are also referenced in the extended instance, such as a simple Java class, an extension of another Dubbo, or a Spring Bean. The situation of dependencies is complex, and Dubbo&rsquo;s processing is relatively complicated. We will have a special chapter to explain it later. Now, we just need to know that Dubbo can correctly inject common dependencies in extension points, Dubbo extension dependencies or Spring dependencies, etc..</li>
<li>Extended instance is auto-wrapping. Auto-wrapping is about implementing Spring like AOP functionality. Dubbo uses it to implement some common functions internally, such as logging, monitoring, and so on. The contents of the extended instance auto-wrapper will also be explained separately later.</li>
</ol>
<p>After the above 4 steps, Dubbo creates and initializes an extended instance. The dependencies of this instance are injected and packaged as needed. At this point, this extended instance can be used.</p>
<h2 id="auto-assembly-of-dubbo-spi-advanced-usage">Auto-assembly of Dubbo SPI advanced usage</h2>
<p>The relevant code for auto-assembly is in the injectExtension method:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> T <span style="color:#268bd2">injectExtension</span><span style="color:#719e07">(</span>T instance<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
    <span style="color:#719e07">for</span> <span style="color:#719e07">(</span>Method method <span style="color:#719e07">:</span> instance<span style="color:#719e07">.</span>getClass<span style="color:#719e07">().</span>getMethods<span style="color:#719e07">())</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>method<span style="color:#719e07">.</span>getName<span style="color:#719e07">().</span>startsWith<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;set&#34;</span><span style="color:#719e07">)</span>
                <span style="color:#719e07">&amp;&amp;</span> method<span style="color:#719e07">.</span>getParameterTypes<span style="color:#719e07">().</span>length <span style="color:#719e07">==</span> 1
                <span style="color:#719e07">&amp;&amp;</span> Modifier<span style="color:#719e07">.</span>isPublic<span style="color:#719e07">(</span>method<span style="color:#719e07">.</span>getModifiers<span style="color:#719e07">()))</span> <span style="color:#719e07">{</span>
            Class<span style="color:#719e07">&lt;?&gt;</span> pt <span style="color:#719e07">=</span> method<span style="color:#719e07">.</span>getParameterTypes<span style="color:#719e07">()[</span>0<span style="color:#719e07">];</span>
          
            String property <span style="color:#719e07">=</span> method<span style="color:#719e07">.</span>getName<span style="color:#719e07">().</span>length<span style="color:#719e07">()</span> <span style="color:#719e07">&gt;</span> 3 <span style="color:#719e07">?</span> method<span style="color:#719e07">.</span>getName<span style="color:#719e07">().</span>substring<span style="color:#719e07">(</span>3<span style="color:#719e07">,</span> 4<span style="color:#719e07">).</span>toLowerCase<span style="color:#719e07">()</span> <span style="color:#719e07">+</span> method<span style="color:#719e07">.</span>getName<span style="color:#719e07">().</span>substring<span style="color:#719e07">(</span>4<span style="color:#719e07">)</span> <span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;&#34;</span><span style="color:#719e07">;</span>
            Object object <span style="color:#719e07">=</span> objectFactory<span style="color:#719e07">.</span>getExtension<span style="color:#719e07">(</span>pt<span style="color:#719e07">,</span> property<span style="color:#719e07">);</span>
            <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>object <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                method<span style="color:#719e07">.</span>invoke<span style="color:#719e07">(</span>instance<span style="color:#719e07">,</span> object<span style="color:#719e07">);</span>
            <span style="color:#719e07">}</span>
        <span style="color:#719e07">}</span>
    <span style="color:#719e07">}</span>
    <span style="color:#719e07">return</span> instance<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>To accomplish the automatic assembly of dependencies of the extended instances, you first need to know what the dependencies are and what the types of dependencies are. The solution of Dubbo is to find the Java standard setter method. That is, the method name starting with set has only one parameter. If such a set method exists in an extension class, Dubbo injects it into dependencies, which is similar to the injection of Spring&rsquo;s set method. However, dependency injection in Dubbo is more complicated than that in Spring, because all the methods injected into Spring are Spring beans and managed by the Spring container. In Dubbo&rsquo;s dependency injection, you may need to inject another extension of Dubbo, or a Spring Bean, or a component of Google guice, or a component in any other framework. Dubbo needs to be able to load extensions from any scenario. In the injectExtension method, it is implemented with <code>Object object = objectFactory. getExtension (pt, property)</code>. ObjectFactory is ExtensionFactory type and initialized when creating ExtensionLoader:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> <span style="color:#268bd2">ExtensionLoader</span><span style="color:#719e07">(</span>Class<span style="color:#719e07">&lt;?&gt;</span> type<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">this</span><span style="color:#719e07">.</span>type <span style="color:#719e07">=</span> type<span style="color:#719e07">;</span>
        objectFactory <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>type <span style="color:#719e07">==</span> ExtensionFactory<span style="color:#719e07">.</span>class <span style="color:#719e07">?</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">:</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>ExtensionFactory<span style="color:#719e07">.</span>class<span style="color:#719e07">).</span>getAdaptiveExtension<span style="color:#719e07">());</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>ObjectFacore is also an extension, obtained through <code>ExtensionLoader.getExtensionLoader(ExtensionFactory.class).getAdaptiveExtension()</code>.</p>
<p><img src="/imgs/blog/dubbo-extensionfactory.png" alt="Dubbo-ExtensionFactory" title=""></p>
<p>ExtensionFactory includes three implementations:</p>
<ol>
<li>SpiExtensionFactory: use Dubbo&rsquo;s Spi to load Extension.</li>
<li>SpringExtensionFactory: load Extension from the Spring container.</li>
<li>AdaptiveExtensionFactory: adaptive AdaptiveExtensionLoader</li>
</ol>
<p>Pay attention to the AdaptiveExtensionLoader here, the source code is as follows:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">@Adaptive</span>
<span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">AdaptiveExtensionFactory</span> <span style="color:#268bd2">implements</span> ExtensionFactory <span style="color:#719e07">{</span>

    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> List<span style="color:#719e07">&lt;</span>ExtensionFactory<span style="color:#719e07">&gt;</span> factories<span style="color:#719e07">;</span>

    <span style="color:#268bd2">public</span> <span style="color:#268bd2">AdaptiveExtensionFactory</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        ExtensionLoader<span style="color:#719e07">&lt;</span>ExtensionFactory<span style="color:#719e07">&gt;</span> loader <span style="color:#719e07">=</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>ExtensionFactory<span style="color:#719e07">.</span>class<span style="color:#719e07">);</span>
        List<span style="color:#719e07">&lt;</span>ExtensionFactory<span style="color:#719e07">&gt;</span> list <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ArrayList<span style="color:#719e07">&lt;</span>ExtensionFactory<span style="color:#719e07">&gt;();</span>
        <span style="color:#719e07">for</span> <span style="color:#719e07">(</span>String name <span style="color:#719e07">:</span> loader<span style="color:#719e07">.</span>getSupportedExtensions<span style="color:#719e07">())</span> <span style="color:#719e07">{</span>
            list<span style="color:#719e07">.</span>add<span style="color:#719e07">(</span>loader<span style="color:#719e07">.</span>getExtension<span style="color:#719e07">(</span>name<span style="color:#719e07">));</span>
        <span style="color:#719e07">}</span>
        factories <span style="color:#719e07">=</span> Collections<span style="color:#719e07">.</span>unmodifiableList<span style="color:#719e07">(</span>list<span style="color:#719e07">);</span>
    <span style="color:#719e07">}</span>

    <span style="color:#268bd2">public</span> <span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> T <span style="color:#268bd2">getExtension</span><span style="color:#719e07">(</span>Class<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> type<span style="color:#719e07">,</span> String name<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">for</span> <span style="color:#719e07">(</span>ExtensionFactory factory <span style="color:#719e07">:</span> factories<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            T extension <span style="color:#719e07">=</span> factory<span style="color:#719e07">.</span>getExtension<span style="color:#719e07">(</span>type<span style="color:#719e07">,</span> name<span style="color:#719e07">);</span>
            <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>extension <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                <span style="color:#719e07">return</span> extension<span style="color:#719e07">;</span>
            <span style="color:#719e07">}</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">return</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">;</span>
    <span style="color:#719e07">}</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>The AdaptiveExtensionLoader class has @Adaptive annotations. As mentioned earlier, Dubbo creates an adaptive instance for each extension. If the extension class has @Adaptive annotations, it will use it as an adaptive class. If not, Dubbo will create one for us. So <code>ExtensionLoader.getExtensionLoader(ExtensionFactory.class).getAdaptiveExtension())</code> will return an AdaptiveExtensionLoader instance as an adaptive extension instance. 
The AdaptiveExtensionLoader will iterate through all the ExtensionFactory implementations and try to load the extensions. If found, return. If not, continue to find it in the next ExtensionFactory. Dubbo has two ExtensionFactory built in, which are searched from Dubbo&rsquo;s own extension mechanism and Spring container. Since ExtensionFactory itself is also an extension point, we can implement our own ExtensionFactory to enable automatic assembly of Dubbo to support our custom components. For example, we used Google&rsquo;s guice as an IoC container in our project. We can implement our own GuiceExtensionFactory to enable Dubbo to load extensions from the guice container.</p>
<h2 id="aop-of-dubbo-spi-advanced-usage">AOP of Dubbo SPI advanced usage</h2>
<p>We often use AOP functionality when using Spring. Insert other logic before and after the method of the target class. For example, Spring AOP is usually used to implement logging, monitoring, and authentication, and so on. 
Does Dubbo&rsquo;s extension mechanism also support similar features? The answer is yes. In Dubbo, there is a special class called the Wrapper class. It uses the wrapper class to wrap the original extension point instance through the decorator pattern, and then inserts additional logic before and after the original extension point implementation to implement AOP functionality.</p>
<h3 id="what-is-the-wrapper-class">What is the Wrapper class</h3>
<p>So what kind of class is the Wrapper class in the Dubbo extension mechanism? The Wrapper class is a class that has a replication constructor and also is a typical decorator pattern. Here&rsquo;s a Wrapper class:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">class</span> <span style="color:#268bd2">A</span><span style="color:#719e07">{</span>
    <span style="color:#268bd2">private</span> A a<span style="color:#719e07">;</span>
    <span style="color:#268bd2">public</span> <span style="color:#268bd2">A</span><span style="color:#719e07">(</span>A a<span style="color:#719e07">){</span>
        <span style="color:#719e07">this</span><span style="color:#719e07">.</span>a <span style="color:#719e07">=</span> a<span style="color:#719e07">;</span>
    <span style="color:#719e07">}</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>Class A has a constructor <code>public A(A a)</code>, and the argument to the constructor is A itself. Such a class can be a Wrapper class in the Dubbo extension mechanism. Such Wrapper classes in Dubbo include ProtocolFilterWrapper, ProtocolListenerWrapper, and so on. You can check the source code to deepen your understanding.</p>
<h3 id="how-to-configure-the-wrapper-class">How to configure the Wrapper class</h3>
<p>The Wrapper class in Dubbo is also an extension point. Like other extension points, it is also configured in the <code>META-INF</code> folder. For example, the ProtocolFilterWrapper and ProtocolListenerWrapper in the previous example are configured in the path <code>dubbo-rpc/dubbo-rpc-api/src/main/resources/META-INF/dubbo/internal/org.apache.dubbo.rpc.Protocol</code>:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">filter=org.apache.dubbo.rpc.protocol.ProtocolFilterWrapper
listener=org.apache.dubbo.rpc.protocol.ProtocolListenerWrapper
mock=org.apache.dubbo.rpc.support.MockProtocol
</code></pre></div><p>When Dubbo loads the extension configuration file, there is a piece of code as follows:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#719e07">try</span> <span style="color:#719e07">{</span>  
  clazz<span style="color:#719e07">.</span>getConstructor<span style="color:#719e07">(</span>type<span style="color:#719e07">);</span>    
  Set<span style="color:#719e07">&lt;</span>Class<span style="color:#719e07">&lt;?&gt;&gt;</span> wrappers <span style="color:#719e07">=</span> cachedWrapperClasses<span style="color:#719e07">;</span>
  <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>wrappers <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
    cachedWrapperClasses <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ConcurrentHashSet<span style="color:#719e07">&lt;</span>Class<span style="color:#719e07">&lt;?&gt;&gt;();</span>
    wrappers <span style="color:#719e07">=</span> cachedWrapperClasses<span style="color:#719e07">;</span>
  <span style="color:#719e07">}</span>
  wrappers<span style="color:#719e07">.</span>add<span style="color:#719e07">(</span>clazz<span style="color:#719e07">);</span>
<span style="color:#719e07">}</span> <span style="color:#719e07">catch</span> <span style="color:#719e07">(</span>NoSuchMethodException e<span style="color:#719e07">)</span> <span style="color:#719e07">{}</span>
</code></pre></div><p>The meaning of this code is that if the extension class has a copy constructor, it will be saved for later use. The class that has the copy constructor is the Wrapper class. The parameter obtained by <code>clazz.getConstructor(type)</code> is the constructor of the extension point interface. Note that the parameter type of the constructor is an extension point interface, not an extension class. 
Take Protocol as an example. The configuration file <code>dubbo-rpc/dubbo-rpc-api/src/main/resources/META-INF/dubbo/internal/org.apache.dubbo.rpc.Protocol defines filter=org.apache.dubbo.rpc.protocol. ProtocolFilterWrapper</code>. 
The code of ProtocolFilterWrapper is as follows:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">ProtocolFilterWrapper</span> <span style="color:#268bd2">implements</span> Protocol <span style="color:#719e07">{</span>

    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> Protocol protocol<span style="color:#719e07">;</span>

    <span style="color:#586e75">// One parameter is the copy constructor of Protocol
</span><span style="color:#586e75"></span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">ProtocolFilterWrapper</span><span style="color:#719e07">(</span>Protocol protocol<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>protocol <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;protocol == null&#34;</span><span style="color:#719e07">);</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">this</span><span style="color:#719e07">.</span>protocol <span style="color:#719e07">=</span> protocol<span style="color:#719e07">;</span>
    <span style="color:#719e07">}</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>ProtocolFilterWrapper has a constructor <code>public ProtocolFilterWrapper(Protocol protocol)</code>, and the parameter is the extension point Protocol. So it is a Wrapper class in the Dubbo extension mechanism. The ExtensionLoader will cache it. When creating Extension instances later, the ExtensionLoader use these wrapper classes to wrap the original Extension point in turn.</p>
<h2 id="extension-point-adaptive">Extension point adaptive</h2>
<p>As mentioned earlier, Dubbo needs to determine which extension to use based on method parameters at runtime. So there is an extension point adaptive instance. In fact, it is an extension point proxy that delays the selection of extensions from starting Dubbo to calling RPC. Each extension point in Dubbo has an adaptive class. If it is not explicitly provided, Dubbo will automatically create one for us. By default, Javaassist is used. 
Let&rsquo;s first look at the code to create an adaptive extension class:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">public</span> T <span style="color:#268bd2">getAdaptiveExtension</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
    Object instance <span style="color:#719e07">=</span> cachedAdaptiveInstance<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
    <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>instance <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            <span style="color:#268bd2">synchronized</span> <span style="color:#719e07">(</span>cachedAdaptiveInstance<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                instance <span style="color:#719e07">=</span> cachedAdaptiveInstance<span style="color:#719e07">.</span>get<span style="color:#719e07">();</span>
                <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>instance <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
                      instance <span style="color:#719e07">=</span> createAdaptiveExtension<span style="color:#719e07">();</span>
                      cachedAdaptiveInstance<span style="color:#719e07">.</span>set<span style="color:#719e07">(</span>instance<span style="color:#719e07">);</span> 
                <span style="color:#719e07">}</span>
            <span style="color:#719e07">}</span>        
    <span style="color:#719e07">}</span>

    <span style="color:#719e07">return</span> <span style="color:#719e07">(</span>T<span style="color:#719e07">)</span> instance<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>Continue to read the createAdaptiveExtension method:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> T <span style="color:#268bd2">createAdaptiveExtension</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>        
    <span style="color:#719e07">return</span> injectExtension<span style="color:#719e07">((</span>T<span style="color:#719e07">)</span> getAdaptiveExtensionClass<span style="color:#719e07">().</span>newInstance<span style="color:#719e07">());</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>Continue to read the getAdaptiveExtensionClass method:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> Class<span style="color:#719e07">&lt;?&gt;</span> getAdaptiveExtensionClass<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        getExtensionClasses<span style="color:#719e07">();</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>cachedAdaptiveClass <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
            <span style="color:#719e07">return</span> cachedAdaptiveClass<span style="color:#719e07">;</span>
        <span style="color:#719e07">}</span>
        <span style="color:#719e07">return</span> cachedAdaptiveClass <span style="color:#719e07">=</span> createAdaptiveExtensionClass<span style="color:#719e07">();</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>Continue to read the createAdaptiveExtensionClass method. After a long journey, we finally come to a concrete realization. Look at this createAdaptiveExtensionClass method, which first generates the Java source code for the adaptive class, and then compile the source code into Java bytecode and load it into the JVM.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">private</span> Class<span style="color:#719e07">&lt;?&gt;</span> createAdaptiveExtensionClass<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        String code <span style="color:#719e07">=</span> createAdaptiveExtensionClassCode<span style="color:#719e07">();</span>
        ClassLoader classLoader <span style="color:#719e07">=</span> findClassLoader<span style="color:#719e07">();</span>
        org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>common<span style="color:#719e07">.</span>compiler<span style="color:#719e07">.</span>Compiler compiler <span style="color:#719e07">=</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>common<span style="color:#719e07">.</span>compiler<span style="color:#719e07">.</span>Compiler<span style="color:#719e07">.</span>class<span style="color:#719e07">).</span>getAdaptiveExtension<span style="color:#719e07">();</span>
        <span style="color:#719e07">return</span> compiler<span style="color:#719e07">.</span>compile<span style="color:#719e07">(</span>code<span style="color:#719e07">,</span> classLoader<span style="color:#719e07">);</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>The default implementation of Compiler&rsquo;s code is javassist.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">@SPI</span><span style="color:#719e07">(</span><span style="color:#2aa198">&#34;javassist&#34;</span><span style="color:#719e07">)</span>
<span style="color:#268bd2">public</span> <span style="color:#268bd2">interface</span> <span style="color:#268bd2">Compiler</span> <span style="color:#719e07">{</span>
    Class<span style="color:#719e07">&lt;?&gt;</span> compile<span style="color:#719e07">(</span>String code<span style="color:#719e07">,</span> ClassLoader classLoader<span style="color:#719e07">);</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>The createAdaptiveExtensionClassCode () method uses a StringBuilder to build Java source code for the adaptive class. The method implementation is relatively long, and the code is not posted here. The approach to bytecode generation is also interesting, first generating Java source code, then compiling it and loading it into the jvm. In this way, the generated Java class can be better controlled. And it doesn&rsquo;t have to care about the API of the bytecode generation framework. Because the xxx.java file is universal in Java, it is also the one we are most familiar with. However, the code is not very readable and you need to build xx. Java content bit by bit. 
Below are the Java code example for Protocol adaptive class created by createAdaptiveExtensionClassCode method:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#719e07">package</span> org.apache.dubbo.rpc<span style="color:#719e07">;</span>

<span style="color:#719e07">import</span> org.apache.dubbo.common.extension.ExtensionLoader<span style="color:#719e07">;</span>

<span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">Protocol$Adaptive</span> <span style="color:#268bd2">implements</span> org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol <span style="color:#719e07">{</span>
    <span style="color:#268bd2">public</span> <span style="color:#dc322f">void</span> <span style="color:#268bd2">destroy</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> UnsupportedOperationException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;method public abstract void org.apache.dubbo.rpc.Protocol.destroy() of interface org.apache.dubbo.rpc.Protocol is not adaptive method!&#34;</span><span style="color:#719e07">);</span>
    <span style="color:#719e07">}</span>

    <span style="color:#268bd2">public</span> <span style="color:#dc322f">int</span> <span style="color:#268bd2">getDefaultPort</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
        <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> UnsupportedOperationException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;method public abstract int org.apache.dubbo.rpc.Protocol.getDefaultPort() of interface org.apache.dubbo.rpc.Protocol is not adaptive method!&#34;</span><span style="color:#719e07">);</span>
    <span style="color:#719e07">}</span>

    <span style="color:#268bd2">public</span> org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Exporter <span style="color:#268bd2">export</span><span style="color:#719e07">(</span>org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Invoker arg0<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>RpcException <span style="color:#719e07">{</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>arg0 <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;org.apache.dubbo.rpc.Invoker argument == null&#34;</span><span style="color:#719e07">);</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>arg0<span style="color:#719e07">.</span>getUrl<span style="color:#719e07">()</span> <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span>
            <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;org.apache.dubbo.rpc.Invoker argument getUrl() == null&#34;</span><span style="color:#719e07">);</span>
        org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>common<span style="color:#719e07">.</span>URL url <span style="color:#719e07">=</span> arg0<span style="color:#719e07">.</span>getUrl<span style="color:#719e07">();</span>
        String extName <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>url<span style="color:#719e07">.</span>getProtocol<span style="color:#719e07">()</span> <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">?</span> <span style="color:#2aa198">&#34;dubbo&#34;</span> <span style="color:#719e07">:</span> url<span style="color:#719e07">.</span>getProtocol<span style="color:#719e07">());</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>extName <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span>
            <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalStateException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;Fail to get extension(org.apache.dubbo.rpc.Protocol) name from url(&#34;</span> <span style="color:#719e07">+</span> url<span style="color:#719e07">.</span>toString<span style="color:#719e07">()</span> <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;) use keys([protocol])&#34;</span><span style="color:#719e07">);</span>
        org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol extension <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol<span style="color:#719e07">)</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol<span style="color:#719e07">.</span>class<span style="color:#719e07">).</span>getExtension<span style="color:#719e07">(</span>extName<span style="color:#719e07">);</span>
        <span style="color:#719e07">return</span> extension<span style="color:#719e07">.</span>export<span style="color:#719e07">(</span>arg0<span style="color:#719e07">);</span>
    <span style="color:#719e07">}</span>

    <span style="color:#268bd2">public</span> org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Invoker <span style="color:#268bd2">refer</span><span style="color:#719e07">(</span>java<span style="color:#719e07">.</span>lang<span style="color:#719e07">.</span>Class arg0<span style="color:#719e07">,</span> org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>common<span style="color:#719e07">.</span>URL arg1<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>RpcException <span style="color:#719e07">{</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>arg1 <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span> <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;url == null&#34;</span><span style="color:#719e07">);</span>
        org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>common<span style="color:#719e07">.</span>URL url <span style="color:#719e07">=</span> arg1<span style="color:#719e07">;</span>
        String extName <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>url<span style="color:#719e07">.</span>getProtocol<span style="color:#719e07">()</span> <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">?</span> <span style="color:#2aa198">&#34;dubbo&#34;</span> <span style="color:#719e07">:</span> url<span style="color:#719e07">.</span>getProtocol<span style="color:#719e07">());</span>
        <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>extName <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span><span style="color:#719e07">)</span>
            <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalStateException<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;Fail to get extension(org.apache.dubbo.rpc.Protocol) name from url(&#34;</span> <span style="color:#719e07">+</span> url<span style="color:#719e07">.</span>toString<span style="color:#719e07">()</span> <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;) use keys([protocol])&#34;</span><span style="color:#719e07">);</span>
        org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol extension <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol<span style="color:#719e07">)</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>org<span style="color:#719e07">.</span>apache<span style="color:#719e07">.</span>dubbo<span style="color:#719e07">.</span>rpc<span style="color:#719e07">.</span>Protocol<span style="color:#719e07">.</span>class<span style="color:#719e07">).</span>getExtension<span style="color:#719e07">(</span>extName<span style="color:#719e07">);</span>
        <span style="color:#719e07">return</span> extension<span style="color:#719e07">.</span>refer<span style="color:#719e07">(</span>arg0<span style="color:#719e07">,</span> arg1<span style="color:#719e07">);</span>
    <span style="color:#719e07">}</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>The general logic is the same as at the beginning. The parameters are parsed through the url, and the parsed logic is controlled by the value parameter of @adaptive, and then the extension points implementation are obtained according to the name of the extension point. And then finally make the call. If you want to know the specific construction logic of .Java code, you can see the complete implementation of <code>createAdaptiveExtensionClassCode</code>. 
In the generated Protocol$Adaptive, both the getDefaultPort and destroy methods are found to throw the exception directly. Why? Take a look at the source code of Protocol:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">@SPI</span><span style="color:#719e07">(</span><span style="color:#2aa198">&#34;dubbo&#34;</span><span style="color:#719e07">)</span>
<span style="color:#268bd2">public</span> <span style="color:#268bd2">interface</span> <span style="color:#268bd2">Protocol</span> <span style="color:#719e07">{</span>

    <span style="color:#dc322f">int</span> <span style="color:#268bd2">getDefaultPort</span><span style="color:#719e07">();</span>

    <span style="color:#268bd2">@Adaptive</span>
    <span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> Exporter<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> <span style="color:#268bd2">export</span><span style="color:#719e07">(</span>Invoker<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> invoker<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> RpcException<span style="color:#719e07">;</span>

    <span style="color:#268bd2">@Adaptive</span>
    <span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> Invoker<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> <span style="color:#268bd2">refer</span><span style="color:#719e07">(</span>Class<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> type<span style="color:#719e07">,</span> URL url<span style="color:#719e07">)</span> <span style="color:#268bd2">throws</span> RpcException<span style="color:#719e07">;</span>

    <span style="color:#dc322f">void</span> <span style="color:#268bd2">destroy</span><span style="color:#719e07">();</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>As you can see, there are four methods in the Protocol interface, but only the methods of export and refer use the @Adaptive annotation. Dubbo automatically generates adaptive instances, and only the methods modified by @Adaptive has a specific implementation. Therefore, in the Protocol$Adaptive class, only the export and refer methods have specific implementations, and the rest of the methods throw exceptions.</p>

  
  
</div>


      </main>
    </div>
    <div class="col-md-2">
    </div>
  </div>
  
</section>

  

<footer id="footer" role="contentinfo">
  <div class="container">
    <img src="/images/nacos_gray.png"/>
    <div class="row">
      <div class="col-md-6"><h3>Vision</h3>
        <p>By providing an easy-to-use service infrastructure such as dynamic service
            discovery, service configuration, service sharing and management and etc., Nacos help users better
            construct, deliver and manage their own service platform, reuse and composite business service
            faster and deliver value of business innovation more quickly so as to win market for users in the
            era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div>
      <div class="col-md-3">
        <dl>
          <dt>Documentation</dt>
          
          <dd><a href="/en-us/docs/what-is-nacos.html" target="_self">Overview</a></dd>
          
          <dd><a href="/en-us/docs/quick-start.html" target="_self">Quick start</a></dd>
          
          <dd><a href="/en-us/docs/contributing.html" target="_self">Developer guide</a></dd>
          
        </dl>
      </div>
      <div class="col-md-3">
        <dl>
          <dt>Resources</dt>
          
          <dd><a href="/en-us/community/index.html" target="_self">Community</a></dd>
          
          <dd><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_self">Cloud Service MSE</a></dd>
          
          <dd><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self">Cloud Service EDAS</a></dd>
          
          <dd><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target="_self">Cloud Service AHAS</a></dd>
          
        </dl>
      </div>
    </div>
    <div class="col-md-12 text-center copyright">
      <span>© 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span>
    </div>
  </div>
</footer>


</body>
<script type="text/javascript">
  ;(function () {
    $('#fh5co-header').addClass('navbar-fixed-top fh5co-animated slideInDown');
    $('#nacosLogo').attr("src", "/images/nacos_colorful.png")
  }());
</script>
</html>