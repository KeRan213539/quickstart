<!DOCTYPE html>






<html lang="zh">
<head>
  

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> 旧路由规则</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <meta http-equiv="content-language" content="zh-cn" />

  

    
    
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Nacos">
    <meta property="og:title" content="旧路由规则">
    <meta property="og:url" content="/zh/docs/v2.7/user/examples/routing-rule-deprecated/">
    <meta property="og:image" content="/images/">
    <meta name="twitter:title" content="Nacos" />
    <meta name="twitter:url" content="/zh/docs/v2.7/user/examples/routing-rule-deprecated/" />
    <meta name="twitter:image" content="/images/" />
    <meta name="twitter:card" content="" />
    
    
    
    <link rel="canonical" href="/zh/docs/v2.7/user/examples/routing-rule-deprecated/"/>

    


    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,400italic,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/leaflet.css" />

    
    <link rel="stylesheet" href="/css/animate.css">
    
    <link rel="stylesheet" href="/css/icomoon.css">
    
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    
    <link rel="stylesheet" href="/css/magnific-popup.css">
    
    <link rel="stylesheet" href="/css/bootstrap.css">

    
    <link rel="stylesheet" href="/css/style.css">

    
    
    <link rel="stylesheet" href="/css/custom1.css">
    
    <link rel="stylesheet" href="/css/custom2.css">
    
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    

    
    <script src="/js/modernizr-2.6.2.min.js"></script>
    
    

  <meta name="referrer" content="no-referrer"/>
  <link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"/>
  	
	<script src="/js/jquery.min.js"></script>
	
	<script src="/js/jquery.easing.1.3.js"></script>
	
	<script src="/js/bootstrap.min.js"></script>
	
	<script src="/js/jquery.waypoints.min.js"></script>
	
	<script src="/js/jquery.stellar.min.js"></script>
	
	<script src="/js/jquery.countTo.js"></script>
	
	<script src="/js/jquery.magnific-popup.min.js"></script>
	<script src="/js/magnific-popup-options.js"></script>
	


	
	<script src="/js/main.js"></script>

</head>
<body>


    <header role="banner" id="fh5co-header">
        <div class="container">
            
            <nav class="navbar navbar-default">
                <div class="navbar-header">
                    
                    <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><i></i></a>
                    <a class="navbar-brand" href="index.html"><img id="nacosLogo" src="/images/nacos.png"></a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                  <ul class="nav navbar-nav navbar-right">
                    
                    
                    
                    <li><a class="external" href="/"><span>首页</span></a></li>
                    
                    
                    

                    

                    

                    

                    

                    
                        <li class="active"><a class="external" href="/zh/docs"><span>文档</span></a></li>
                    
                        <li><a class="external" href="/zh/blog"><span>博客</span></a></li>
                    
                    <li>
                      

<div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false" >
		中文
		<span class="caret"></span>
	</button>
	<ul class="dropdown-menu">
		
		<li><a class="external" href="/">English</a></li>
		
	</ul>
</div>
                    </li>
                </ul>
            </div>
        </nav>
        
    </div>
</header>

<section class="animated">
  <div class="col-md-2 blogDocSidebar">
    




<a href="#" id="sidebarConsoleBtn"><i class="fa fa-bars fa-fw"></i></a>
<div id="sidebarContent">
  
  






<ul>
  <li>
    <a href="/zh/docs/" >文档</a>
  </li>
  <ul>
    <li class="collapse show" id="zhdocs">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/" >Dubbo 2.7</a>
  </li>
  <ul>
    <li class="collapse show" id="zhdocsv27">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/" >用户文档</a>
  </li>
  <ul>
    <li class="collapse show" id="zhdocsv27user">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/preface/" >入门</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userpreface">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userprefacebackground" href="/zh/docs/v2.7/user/preface/background/">背景</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userprefacerequirements" href="/zh/docs/v2.7/user/preface/requirements/">需求</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userprefacearchitecture" href="/zh/docs/v2.7/user/preface/architecture/">架构</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userprefaceusage" href="/zh/docs/v2.7/user/preface/usage/">用法</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          
          
          <a id="m-zhdocsv27userquick-start" href="/zh/docs/v2.7/user/quick-start/">快速开始</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userdependencies" href="/zh/docs/v2.7/user/dependencies/">依赖</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27usermaturity" href="/zh/docs/v2.7/user/maturity/">成熟度</a>
        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/configuration/" >配置</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userconfiguration">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationxml" href="/zh/docs/v2.7/user/configuration/xml/">XML 配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationconfig-center" href="/zh/docs/v2.7/user/configuration/config-center/">动态配置中心</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationproperties" href="/zh/docs/v2.7/user/configuration/properties/">属性配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationenvironment-variables" href="/zh/docs/v2.7/user/configuration/environment-variables/">自动加载环境变量</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationapi" href="/zh/docs/v2.7/user/configuration/api/">API 配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationannotation" href="/zh/docs/v2.7/user/configuration/annotation/">注解配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userconfigurationconfiguration-load-process" href="/zh/docs/v2.7/user/configuration/configuration-load-process/">配置加载流程</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a class="active" href="/zh/docs/v2.7/user/examples/" >用法示例</a>
  </li>
  <ul>
    <li class="collapse show" id="zhdocsv27userexamples">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplespreflight-check" href="/zh/docs/v2.7/user/examples/preflight-check/">启动时检查</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesfault-tolerent-strategy" href="/zh/docs/v2.7/user/examples/fault-tolerent-strategy/">集群容错</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesloadbalance" href="/zh/docs/v2.7/user/examples/loadbalance/">负载均衡</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesthread-model" href="/zh/docs/v2.7/user/examples/thread-model/">线程模型</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesexplicit-target" href="/zh/docs/v2.7/user/examples/explicit-target/">直连提供者</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplessubscribe-only" href="/zh/docs/v2.7/user/examples/subscribe-only/">只订阅</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesmulti-protocols" href="/zh/docs/v2.7/user/examples/multi-protocols/">多协议</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesmulti-registry" href="/zh/docs/v2.7/user/examples/multi-registry/">多注册中心</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesservice-group" href="/zh/docs/v2.7/user/examples/service-group/">服务分组</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesstatic-service" href="/zh/docs/v2.7/user/examples/static-service/">静态服务</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesmulti-versions" href="/zh/docs/v2.7/user/examples/multi-versions/">多版本</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesgroup-merger" href="/zh/docs/v2.7/user/examples/group-merger/">分组聚合</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesparameter-validation" href="/zh/docs/v2.7/user/examples/parameter-validation/">参数验证</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesresult-cache" href="/zh/docs/v2.7/user/examples/result-cache/">结果缓存</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesgeneric-reference" href="/zh/docs/v2.7/user/examples/generic-reference/">使用泛化调用</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesprotobuf-idl" href="/zh/docs/v2.7/user/examples/protobuf-idl/">Protobuf</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplespb-generic-reference" href="/zh/docs/v2.7/user/examples/pb-generic-reference/">Protobuf 泛化调用</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesgeneric-service" href="/zh/docs/v2.7/user/examples/generic-service/">实现泛化调用</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesecho-service" href="/zh/docs/v2.7/user/examples/echo-service/">回声测试</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplescontext" href="/zh/docs/v2.7/user/examples/context/">上下文信息</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesattachment" href="/zh/docs/v2.7/user/examples/attachment/">隐式参数</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesasync-execute-on-provider" href="/zh/docs/v2.7/user/examples/async-execute-on-provider/">异步执行</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesasync-call" href="/zh/docs/v2.7/user/examples/async-call/">异步调用</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexampleslocal-call" href="/zh/docs/v2.7/user/examples/local-call/">本地调用</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplescallback-parameter" href="/zh/docs/v2.7/user/examples/callback-parameter/">参数回调</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesevents-notify" href="/zh/docs/v2.7/user/examples/events-notify/">事件通知</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexampleslocal-stub" href="/zh/docs/v2.7/user/examples/local-stub/">本地存根</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexampleslocal-mock" href="/zh/docs/v2.7/user/examples/local-mock/">本地伪装</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesdelay-publish" href="/zh/docs/v2.7/user/examples/delay-publish/">延迟暴露</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesconcurrency-control" href="/zh/docs/v2.7/user/examples/concurrency-control/">并发控制</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesconfig-connections" href="/zh/docs/v2.7/user/examples/config-connections/">连接控制</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexampleslazy-connect" href="/zh/docs/v2.7/user/examples/lazy-connect/">延迟连接</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesstickiness" href="/zh/docs/v2.7/user/examples/stickiness/">粘滞连接</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplestls" href="/zh/docs/v2.7/user/examples/tls/">TLS</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplestoken-authorization" href="/zh/docs/v2.7/user/examples/token-authorization/">令牌验证</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesrouting-rule" href="/zh/docs/v2.7/user/examples/routing-rule/">路由规则</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesrouting-rule-deprecated" class="active2" href="/zh/docs/v2.7/user/examples/routing-rule-deprecated/">旧路由规则</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesconfig-rule" href="/zh/docs/v2.7/user/examples/config-rule/">配置规则</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesconfig-rule-deprecated" href="/zh/docs/v2.7/user/examples/config-rule-deprecated/">旧配置规则</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesservice-downgrade" href="/zh/docs/v2.7/user/examples/service-downgrade/">服务降级</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesconsumer-threadpool" href="/zh/docs/v2.7/user/examples/consumer-threadpool/">消费端线程池模型</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesgraceful-shutdown" href="/zh/docs/v2.7/user/examples/graceful-shutdown/">优雅停机</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexampleshostname-binding" href="/zh/docs/v2.7/user/examples/hostname-binding/">主机绑定</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesset-host" href="/zh/docs/v2.7/user/examples/set-host/">主机配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplessimplify-registry-data" href="/zh/docs/v2.7/user/examples/simplify-registry-data/">注册信息简化</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexampleslogger-strategy" href="/zh/docs/v2.7/user/examples/logger-strategy/">日志适配</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesaccesslog" href="/zh/docs/v2.7/user/examples/accesslog/">访问日志</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesservice-container" href="/zh/docs/v2.7/user/examples/service-container/">服务容器</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesreference-config-cache" href="/zh/docs/v2.7/user/examples/reference-config-cache/">ReferenceConfig 缓存</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userexamplesregistry-only" href="/zh/docs/v2.7/user/examples/registry-only/">只注册</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/references/" >参考手册</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userreferences">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/references/xml/" >XML 配置</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userreferencesxml">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-application" href="/zh/docs/v2.7/user/references/xml/dubbo-application/">dubbo:application</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-argument" href="/zh/docs/v2.7/user/references/xml/dubbo-argument/">dubbo:argument</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-config-center" href="/zh/docs/v2.7/user/references/xml/dubbo-config-center/">dubbo:config-center</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-consumer" href="/zh/docs/v2.7/user/references/xml/dubbo-consumer/">dubbo:consumer</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-method" href="/zh/docs/v2.7/user/references/xml/dubbo-method/">dubbo:method</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-module" href="/zh/docs/v2.7/user/references/xml/dubbo-module/">dubbo:module</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-monitor" href="/zh/docs/v2.7/user/references/xml/dubbo-monitor/">dubbo:monitor</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-parameter" href="/zh/docs/v2.7/user/references/xml/dubbo-parameter/">dubbo:parameter</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-protocol" href="/zh/docs/v2.7/user/references/xml/dubbo-protocol/">dubbo:protocol</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-provider" href="/zh/docs/v2.7/user/references/xml/dubbo-provider/">dubbo:provider</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-reference" href="/zh/docs/v2.7/user/references/xml/dubbo-reference/">dubbo:reference</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-registry" href="/zh/docs/v2.7/user/references/xml/dubbo-registry/">dubbo:registry</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesxmldubbo-service" href="/zh/docs/v2.7/user/references/xml/dubbo-service/">dubbo:service</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/references/protocol/" >协议参考手册</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userreferencesprotocol">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocoldubbo" href="/zh/docs/v2.7/user/references/protocol/dubbo/">dubbo://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolrest" href="/zh/docs/v2.7/user/references/protocol/rest/">rest://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolhttp" href="/zh/docs/v2.7/user/references/protocol/http/">http://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolhessian" href="/zh/docs/v2.7/user/references/protocol/hessian/">hessian://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolredis" href="/zh/docs/v2.7/user/references/protocol/redis/">redis://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolthrift" href="/zh/docs/v2.7/user/references/protocol/thrift/">thrift://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolgrpc" href="/zh/docs/v2.7/user/references/protocol/grpc/">grpc://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolmemcached" href="/zh/docs/v2.7/user/references/protocol/memcached/">memcached://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolrmi" href="/zh/docs/v2.7/user/references/protocol/rmi/">rmi://</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesprotocolwebservice" href="/zh/docs/v2.7/user/references/protocol/webservice/">webservice://</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/references/registry/" >注册中心参考手册</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userreferencesregistry">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesregistrynacos" href="/zh/docs/v2.7/user/references/registry/nacos/">Nacos</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesregistryzookeeper" href="/zh/docs/v2.7/user/references/registry/zookeeper/">Zookeeper</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesregistrymulticast" href="/zh/docs/v2.7/user/references/registry/multicast/">Multicast</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesregistryredis" href="/zh/docs/v2.7/user/references/registry/redis/">Redis</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesregistrysimple" href="/zh/docs/v2.7/user/references/registry/simple/">Simple</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesmetadata" href="/zh/docs/v2.7/user/references/metadata/">元数据参考手册</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesapi" href="/zh/docs/v2.7/user/references/api/">API 参考手册</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesqos" href="/zh/docs/v2.7/user/references/qos/">QOS 手册</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencestelnet" href="/zh/docs/v2.7/user/references/telnet/">Telnet 手册</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userreferencesmaven" href="/zh/docs/v2.7/user/references/maven/">Maven 插件参考手册</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/versions/" >版本升级</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userversions">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userversionsversion-270" href="/zh/docs/v2.7/user/versions/version-270/">2.7.0</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          
          
          <a id="m-zhdocsv27userbest-practice" href="/zh/docs/v2.7/user/best-practice/">服务化最佳实践</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userrecommend" href="/zh/docs/v2.7/user/recommend/">推荐用法</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27usercapacity-plan" href="/zh/docs/v2.7/user/capacity-plan/">容量规划</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userperf-test" href="/zh/docs/v2.7/user/perf-test/">性能测试报告</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27usercoveragence" href="/zh/docs/v2.7/user/coveragence/">测试覆盖率报告</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userbenchmark-tool" href="/zh/docs/v2.7/user/benchmark-tool/">基准测试</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userrest" href="/zh/docs/v2.7/user/rest/">REST 支持</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27usersimple-monitor" href="/zh/docs/v2.7/user/simple-monitor/">简单监控</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userserialization" href="/zh/docs/v2.7/user/serialization/">Kryo 和 FST 序列化</a>
        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/languages/" >其他语言支持</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userlanguages">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/user/languages/erlang/" >Erlang</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27userlanguageserlang">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27userlanguageserlangquick-start" href="/zh/docs/v2.7/user/languages/erlang/quick-start/">快速开始</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userlanguageserlangreference" href="/zh/docs/v2.7/user/languages/erlang/reference/">消费者配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userlanguageserlangservice" href="/zh/docs/v2.7/user/languages/erlang/service/">提供者配置</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27userlanguageserlangserialization" href="/zh/docs/v2.7/user/languages/erlang/serialization/">序列化配置项</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          
          
          <a id="m-zhdocsv27usernew-features-in-a-glance" href="/zh/docs/v2.7/user/new-features-in-a-glance/"></a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/dev/" >开发指南</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27dev">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27devbuild" href="/zh/docs/v2.7/dev/build/">源码构建</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devdesign" href="/zh/docs/v2.7/dev/design/">框架设计</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devspi" href="/zh/docs/v2.7/dev/spi/">扩展点加载</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplementation" href="/zh/docs/v2.7/dev/implementation/">实现细节</a>
        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/dev/impls/" >SPI 扩展实现</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27devimpls">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsprotocol" href="/zh/docs/v2.7/dev/impls/protocol/">协议扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsfilter" href="/zh/docs/v2.7/dev/impls/filter/">调用拦截扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsinvoker-listener" href="/zh/docs/v2.7/dev/impls/invoker-listener/">引用监听扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsexporter-listener" href="/zh/docs/v2.7/dev/impls/exporter-listener/">暴露监听扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplscluster" href="/zh/docs/v2.7/dev/impls/cluster/">集群扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsrouter" href="/zh/docs/v2.7/dev/impls/router/">路由扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsload-balance" href="/zh/docs/v2.7/dev/impls/load-balance/">负载均衡扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsmerger" href="/zh/docs/v2.7/dev/impls/merger/">合并结果扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsregistry" href="/zh/docs/v2.7/dev/impls/registry/">注册中心扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsmonitor" href="/zh/docs/v2.7/dev/impls/monitor/">监控中心扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsextension-factory" href="/zh/docs/v2.7/dev/impls/extension-factory/">扩展点加载扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsproxy-factory" href="/zh/docs/v2.7/dev/impls/proxy-factory/">动态代理扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplscompiler" href="/zh/docs/v2.7/dev/impls/compiler/">编译器扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsconfig-center" href="/zh/docs/v2.7/dev/impls/config-center/">配置中心扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsdispatcher" href="/zh/docs/v2.7/dev/impls/dispatcher/">消息派发扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsthreadpool" href="/zh/docs/v2.7/dev/impls/threadpool/">线程池扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsserialize" href="/zh/docs/v2.7/dev/impls/serialize/">序列化扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsremoting" href="/zh/docs/v2.7/dev/impls/remoting/">网络传输扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsexchanger" href="/zh/docs/v2.7/dev/impls/exchanger/">信息交换扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsnetworker" href="/zh/docs/v2.7/dev/impls/networker/">组网扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplstelnet-handler" href="/zh/docs/v2.7/dev/impls/telnet-handler/">Telnet 命令扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsstatus-checker" href="/zh/docs/v2.7/dev/impls/status-checker/">状态检查扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplscontainer" href="/zh/docs/v2.7/dev/impls/container/">容器扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplscache" href="/zh/docs/v2.7/dev/impls/cache/">缓存扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplsvalidation" href="/zh/docs/v2.7/dev/impls/validation/">验证扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplslogger-adapter" href="/zh/docs/v2.7/dev/impls/logger-adapter/">日志适配扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devimplspage" href="/zh/docs/v2.7/dev/impls/page/"></a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/dev/principals/" >设计原则</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27devprincipals">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalscode-detail" href="/zh/docs/v2.7/dev/principals/code-detail/">魔鬼在细节</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsconfiguration" href="/zh/docs/v2.7/dev/principals/configuration/">配置设计</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsdummy" href="/zh/docs/v2.7/dev/principals/dummy/">防痴呆设计</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsexpansibility" href="/zh/docs/v2.7/dev/principals/expansibility/">谈谈扩充式扩展与增量式扩展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsextension" href="/zh/docs/v2.7/dev/principals/extension/">扩展点重构</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsgeneral-knowledge" href="/zh/docs/v2.7/dev/principals/general-knowledge/">一些设计上的基本常识</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsrobustness" href="/zh/docs/v2.7/dev/principals/robustness/">设计实现的健壮性</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devprincipalsintroduction" href="/zh/docs/v2.7/dev/principals/introduction/"></a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          
          
          <a id="m-zhdocsv27devcontract" href="/zh/docs/v2.7/dev/contract/">公共契约</a>
        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/dev/source/" >源代码</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27devsource">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourcedubbo-spi" href="/zh/docs/v2.7/dev/source/dubbo-spi/">Dubbo SPI</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourcerouter" href="/zh/docs/v2.7/dev/source/router/">服务路由</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourceadaptive-extension" href="/zh/docs/v2.7/dev/source/adaptive-extension/">SPI 自适应拓展</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourceexport-service" href="/zh/docs/v2.7/dev/source/export-service/">服务导出</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourcerefer-service" href="/zh/docs/v2.7/dev/source/refer-service/">服务引用</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourceservice-invoking-process" href="/zh/docs/v2.7/dev/source/service-invoking-process/">服务调用过程</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourcedirectory" href="/zh/docs/v2.7/dev/source/directory/">服务目录</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourcecluster" href="/zh/docs/v2.7/dev/source/cluster/">集群</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devsourceloadbalance" href="/zh/docs/v2.7/dev/source/loadbalance/">负载均衡</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          
          
          <a id="m-zhdocsv27devrelease" href="/zh/docs/v2.7/dev/release/">版本管理</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devchecklist" href="/zh/docs/v2.7/dev/checklist/">检查列表</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devcode-smell" href="/zh/docs/v2.7/dev/code-smell/">坏味道</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devcoding" href="/zh/docs/v2.7/dev/coding/">编码约定</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27devtck" href="/zh/docs/v2.7/dev/tck/">TCK</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/admin/" >运维管理指南</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27admin">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/admin/ops/" >Dubbo Admin 运维指南</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27adminops">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopsfunctions" href="/zh/docs/v2.7/admin/ops/functions/">管理控制台运维</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopsintroduction" href="/zh/docs/v2.7/admin/ops/introduction/">Dubbo 管理控制台介绍</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopssearch" href="/zh/docs/v2.7/admin/ops/search/">服务查询和详情展示</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopstest" href="/zh/docs/v2.7/admin/ops/test/">服务测试</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopsapidocs" href="/zh/docs/v2.7/admin/ops/apidocs/">API文档&amp;测试</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopsgovernance" href="/zh/docs/v2.7/admin/ops/governance/">服务治理和配置管理</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopsskywalking" href="/zh/docs/v2.7/admin/ops/skywalking/">使用 Apache Skywalking 做分布式跟踪</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27adminopspinpoint" href="/zh/docs/v2.7/admin/ops/pinpoint/">使用 Pinpoint 做分布式跟踪</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v2.7/admin/install/" >安装手册</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv27admininstall">
      
      
      
      
        
          
          
          <a id="m-zhdocsv27admininstalladmin-console" href="/zh/docs/v2.7/admin/install/admin-console/">管理控制台安装</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27admininstallprovider-demo" href="/zh/docs/v2.7/admin/install/provider-demo/">示例提供者安装</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27admininstallconsumer-demo" href="/zh/docs/v2.7/admin/install/consumer-demo/">示例消费者安装</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27admininstallredis" href="/zh/docs/v2.7/admin/install/redis/">Redis 注册中心安装</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27admininstallzookeeper" href="/zh/docs/v2.7/admin/install/zookeeper/">Zookeeper 注册中心安装</a>
        
      
      
      
        
          
          
          <a id="m-zhdocsv27admininstallmonitor-center" href="/zh/docs/v2.7/admin/install/monitor-center/">Simple 监控中心安装</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/v3.0/" >Dubbo 3.0</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocsv30">
      
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/contribution-guidelines/" >贡献指南</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocscontribution-guidelines">
      
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/contribution-guidelines/contributor/" >Contributor 指南</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocscontribution-guidelinescontributor">
      
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributorbecome-a-committer_dev" href="/zh/docs/contribution-guidelines/contributor/become-a-committer_dev/">成为 Committer</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributorcla-signing-guide_dev" href="/zh/docs/contribution-guidelines/contributor/cla-signing-guide_dev/">CLA 签署向导</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributornew-contributor-guide_dev" href="/zh/docs/contribution-guidelines/contributor/new-contributor-guide_dev/">新手向导</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributormailing-list-subscription-guide_dev" href="/zh/docs/contribution-guidelines/contributor/mailing-list-subscription-guide_dev/">邮件组向导</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributorreporting-security-issues_dev" href="/zh/docs/contribution-guidelines/contributor/reporting-security-issues_dev/">反馈漏洞</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributorsoftware-donation-guide_dev" href="/zh/docs/contribution-guidelines/contributor/software-donation-guide_dev/">捐献向导</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributordubbo-extension-guide_dev" href="/zh/docs/contribution-guidelines/contributor/dubbo-extension-guide_dev/">扩展 Dubbo</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescontributortest-coverage-guide_dev" href="/zh/docs/contribution-guidelines/contributor/test-coverage-guide_dev/">测试覆盖率向导</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul>
  <li>
    <a href="/zh/docs/contribution-guidelines/committer/" >Committer 指南</a>
  </li>
  <ul>
    <li class="collapse " id="zhdocscontribution-guidelinescommitter">
      
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescommitternew-committer-guide_dev" href="/zh/docs/contribution-guidelines/committer/new-committer-guide_dev/">注册流程</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescommitterrelease-guide_dev" href="/zh/docs/contribution-guidelines/committer/release-guide_dev/">发版准备</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescommitterwebsite-guide_dev" href="/zh/docs/contribution-guidelines/committer/website-guide_dev/">网站向导</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescommitterlabel-an-issue-guide_dev" href="/zh/docs/contribution-guidelines/committer/label-an-issue-guide_dev/">问题标签</a>
        
      
      
      
        
          
          
          <a id="m-zhdocscontribution-guidelinescommitterapache-dubbo-page_dev" href="/zh/docs/contribution-guidelines/committer/apache-dubbo-page_dev/">官方主页</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

</div>

<script>
  $(function() {
    $("#sidebarConsoleBtn").click(function () {
      $("#sidebarContent").toggle();
    });
  });
</script>



  </div>
  <div class="col-md-2 blogDocToc">
    






<div class="td-page-meta">






<a href="https://github.com/nacos-group/nacos-group.github.io/issues/new?title=%e6%97%a7%e8%b7%af%e7%94%b1%e8%a7%84%e5%88%99" target="_blank"><i class="fa fa-github fa-fw"></i> 提交文档问题</a>


<a href="https://github.com/alibaba/nacos/issues/new" target="_blank"><i class="fa fa-tasks fa-fw"></i> 提交项目问题</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#写入路由规则">写入路由规则</a></li>
    <li><a href="#条件路由规则">条件路由规则</a>
      <ul>
        <li><a href="#规则">规则：</a></li>
        <li><a href="#表达式">表达式：</a></li>
        <li><a href="#示例">示例：</a></li>
      </ul>
    </li>
    <li><a href="#脚本路由规则">脚本路由规则</a></li>
    <li><a href="#标签路由规则">标签路由规则</a>
      <ul>
        <li><a href="#服务提供者">服务提供者</a></li>
        <li><a href="#服务消费者">服务消费者</a></li>
        <li><a href="#规则描述">规则描述</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </div>
  <div class="row">
    <div class="col-md-2">
    </div>
    <div class="col-md-8 blogDocContent">
      


<div class="row">
  <div class="col-md-2">
    <ul>
      
    </ul>
  </div>
  <div class="col-md-10">
    
  </div>
</div>
<div class="td-content">
  <h1>旧路由规则</h1>
  
  <div class="lead">在 Dubbo <code>2.6.x</code> 版本以及更早的版本中配置路由规则</div>
  
  <div class="td-byline mb-4">
    <time datetime="0001-01-01" class="text-muted">0001-01-01</time>
  </div>
  
  <p>路由规则 <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> 决定一次 dubbo 服务调用的目标服务器，分为条件路由规则和脚本路由规则，并且支持可扩展 <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>。</p>
<h2 id="写入路由规则">写入路由规则</h2>
<p>向注册中心写入路由规则的操作通常由监控中心或治理中心的页面完成</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">RegistryFactory registryFactory <span style="color:#719e07">=</span> ExtensionLoader<span style="color:#719e07">.</span>getExtensionLoader<span style="color:#719e07">(</span>RegistryFactory<span style="color:#719e07">.</span>class<span style="color:#719e07">).</span>getAdaptiveExtension<span style="color:#719e07">();</span>
Registry registry <span style="color:#719e07">=</span> registryFactory<span style="color:#719e07">.</span>getRegistry<span style="color:#719e07">(</span>URL<span style="color:#719e07">.</span>valueOf<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;zookeeper://10.20.153.10:2181&#34;</span><span style="color:#719e07">));</span>
registry<span style="color:#719e07">.</span>register<span style="color:#719e07">(</span>URL<span style="color:#719e07">.</span>valueOf<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;route://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&#34;</span> <span style="color:#719e07">+</span> URL<span style="color:#719e07">.</span>encode<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;host = 10.20.153.10 =&gt; host = 10.20.153.11&#34;</span><span style="color:#719e07">)));</span>
</code></pre></div><p>其中：</p>
<ul>
<li><code>route://</code> 表示路由规则的类型，支持条件路由规则和脚本路由规则，可扩展，<strong>必填</strong>。</li>
<li><code>0.0.0.0</code> 表示对所有 IP 地址生效，如果只想对某个 IP 的生效，请填入具体 IP，<strong>必填</strong>。</li>
<li><code>com.foo.BarService</code> 表示只对指定服务生效，<strong>必填</strong>。</li>
<li><code>group=foo</code> 对指定服务的指定group生效，不填表示对未配置group的指定服务生效</li>
<li><code>version=1.0</code>对指定服务的指定version生效，不填表示对未配置version的指定服务生效</li>
<li><code>category=routers</code> 表示该数据为动态配置类型，<strong>必填</strong>。</li>
<li><code>dynamic=false</code> 表示该数据为持久数据，当注册方退出时，数据依然保存在注册中心，<strong>必填</strong>。</li>
<li><code>enabled=true</code> 覆盖规则是否生效，可不填，缺省生效。</li>
<li><code>force=false</code> 当路由结果为空时，是否强制执行，如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为 <code>false</code>。</li>
<li><code>runtime=false</code> 是否在每次调用时执行路由规则，否则只在提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。如果用了参数路由，必须设为 <code>true</code>，需要注意设置会影响调用的性能，可不填，缺省为 <code>false</code>。</li>
<li><code>priority=1</code> 路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为 <code>0</code>。</li>
<li><code>rule=URL.encode(&quot;host = 10.20.153.10 =&gt; host = 10.20.153.11&quot;)</code> 表示路由规则的内容，<strong>必填</strong>。</li>
</ul>
<h2 id="条件路由规则">条件路由规则</h2>
<p>基于条件表达式的路由规则，如：<code>host = 10.20.153.10 =&gt; host = 10.20.153.11</code></p>
<h3 id="规则">规则：</h3>
<ul>
<li><code>=&gt;</code> 之前的为消费者匹配条件，所有参数和消费者的 URL 进行对比，当消费者满足匹配条件时，对该消费者执行后面的过滤规则。</li>
<li><code>=&gt;</code> 之后为提供者地址列表的过滤条件，所有参数和提供者的 URL 进行对比，消费者最终只拿到过滤后的地址列表。</li>
<li>如果匹配条件为空，表示对所有消费方应用，如：<code>=&gt; host != 10.20.153.11</code></li>
<li>如果过滤条件为空，表示禁止访问，如：<code>host = 10.20.153.10 =&gt;</code></li>
</ul>
<h3 id="表达式">表达式：</h3>
<p>参数支持：</p>
<ul>
<li>服务调用信息，如：method, argument 等，暂不支持参数路由</li>
<li>URL 本身的字段，如：protocol, host, port 等</li>
<li>以及 URL 上的所有参数，如：application, organization 等</li>
</ul>
<p>条件支持：</p>
<ul>
<li>等号 <code>=</code> 表示&quot;匹配&quot;，如：<code>host = 10.20.153.10</code></li>
<li>不等号 <code>!=</code> 表示&quot;不匹配&quot;，如：<code>host != 10.20.153.10</code></li>
</ul>
<p>值支持：</p>
<ul>
<li>以逗号 <code>,</code> 分隔多个值，如：<code>host != 10.20.153.10,10.20.153.11</code></li>
<li>以星号 <code>*</code> 结尾，表示通配，如：<code>host != 10.20.*</code></li>
<li>以美元符 <code>$</code> 开头，表示引用消费者参数，如：<code>host = $host</code></li>
</ul>
<h3 id="示例">示例：</h3>
<ol start="0">
<li>
<p>排除预发布机：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">=&gt; host != 172.22.3.91
</code></pre></div></li>
<li>
<p>白名单 <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">host != 10.20.153.10,10.20.153.11 =&gt;
</code></pre></div></li>
<li>
<p>黑名单：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">host = 10.20.153.10,10.20.153.11 =&gt;
</code></pre></div></li>
<li>
<p>服务寄宿在应用上，只暴露一部分的机器，防止整个集群挂掉：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">=&gt; host = 172.22.3.1*,172.22.3.2*
</code></pre></div></li>
<li>
<p>为重要应用提供额外的机器：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">application != kylin =&gt; host != 172.22.3.95,172.22.3.96
</code></pre></div></li>
<li>
<p>读写分离：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">method = find*,list*,get*,is* =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
method != find*,list*,get*,is* =&gt; host = 172.22.3.97,172.22.3.98
</code></pre></div></li>
<li>
<p>前后台分离：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">application = bops =&gt; host = 172.22.3.91,172.22.3.92,172.22.3.93
application != bops =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
</code></pre></div></li>
<li>
<p>隔离不同机房网段：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">host != 172.22.3.* =&gt; host != 172.22.3.*
</code></pre></div></li>
<li>
<p>提供者与消费者部署在同集群内，本机只访问本机的服务：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">=&gt; host = $host
</code></pre></div></li>
</ol>
<h2 id="脚本路由规则">脚本路由规则</h2>
<p>脚本路由规则 <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> 支持 JDK 脚本引擎的所有脚本，比如：javascript, jruby, groovy 等，通过 <code>type=javascript</code> 参数设置脚本类型，缺省为 javascript。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&#34;script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&#34; + URL.encode(&#34;（function route(invokers) { ... } (invokers)）&#34;)
</code></pre></div><p>基于脚本引擎的路由规则，如：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">（<span style="color:#268bd2">function</span> route(invokers) {
    <span style="color:#268bd2">var</span> result <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> java.util.ArrayList(invokers.size());
    <span style="color:#719e07">for</span> (i <span style="color:#719e07">=</span> <span style="color:#2aa198">0</span>; i <span style="color:#719e07">&lt;</span> invokers.size(); i <span style="color:#719e07">++</span>) {
        <span style="color:#719e07">if</span> (<span style="color:#2aa198">&#34;10.20.153.10&#34;</span>.equals(invokers.get(i).getUrl().getHost())) {
            result.add(invokers.get(i));
        }
    }
    <span style="color:#719e07">return</span> result;
} (invokers)）; <span style="color:#586e75">// 表示立即执行方法
</span></code></pre></div><h2 id="标签路由规则">标签路由规则</h2>
<p>标签路由规则 <sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> ，当应用选择装配标签路由(TagRouter)之后，一次 dubbo 调用能够根据请求携带的 tag 标签智能地选择对应 tag 的服务提供者进行调用。</p>
<h3 id="服务提供者">服务提供者</h3>
<ol>
<li>给应用装配标签路由器：</li>
</ol>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#268bd2">@Bean</span>
<span style="color:#268bd2">public</span> ApplicationConfig <span style="color:#268bd2">applicationConfig</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
    ApplicationConfig applicationConfig <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ApplicationConfig<span style="color:#719e07">();</span>
    applicationConfig<span style="color:#719e07">.</span>setName<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;provider-book&#34;</span><span style="color:#719e07">);</span>
    applicationConfig<span style="color:#719e07">.</span>setQosEnable<span style="color:#719e07">(</span><span style="color:#cb4b16">false</span><span style="color:#719e07">);</span>
    <span style="color:#586e75">// instruct tag router
</span><span style="color:#586e75"></span>    Map<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">,</span>String<span style="color:#719e07">&gt;</span> parameters <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> HashMap<span style="color:#719e07">&lt;&gt;();</span>
    parameters<span style="color:#719e07">.</span>put<span style="color:#719e07">(</span>Constants<span style="color:#719e07">.</span>ROUTER_KEY<span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;tag&#34;</span><span style="color:#719e07">);</span>
    applicationConfig<span style="color:#719e07">.</span>setParameters<span style="color:#719e07">(</span>parameters<span style="color:#719e07">);</span>
    <span style="color:#719e07">return</span> applicationConfig<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><ol start="2">
<li>给应用设置具体的标签：</li>
</ol>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#268bd2">@Bean</span>
<span style="color:#268bd2">public</span> ProviderConfig <span style="color:#268bd2">providerConfig</span><span style="color:#719e07">(){</span>
	ProviderConfig providerConfig <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ProviderConfig<span style="color:#719e07">();</span>
	providerConfig<span style="color:#719e07">.</span>setTag<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;red&#34;</span><span style="color:#719e07">);</span>
	<span style="color:#719e07">return</span> providerConfig<span style="color:#719e07">;</span>
<span style="color:#719e07">}</span>
</code></pre></div><p>应用未装配 tag 属性或服务提供者未设置 tag 属性，都将被认为是默认的应用，这些默认应用将会在调用无法匹配 provider 时当作降级方案。</p>
<h3 id="服务消费者">服务消费者</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java">RpcContext<span style="color:#719e07">.</span>getContext<span style="color:#719e07">().</span>setAttachment<span style="color:#719e07">(</span>Constants<span style="color:#719e07">.</span>REQUEST_TAG_KEY<span style="color:#719e07">,</span><span style="color:#2aa198">&#34;red&#34;</span><span style="color:#719e07">);</span>
</code></pre></div><p>请求标签的作用域为每一次 invocation，使用 attachment 来传递请求标签，注意保存在 attachment 中的值将会在一次完整的远程调用中持续传递，得益于这样的特性，我们只需要在起始调用时，通过一行代码的设置，达到标签的持续传递。</p>
<blockquote>
<p>目前仅仅支持 hardcoding 的方式设置 requestTag。注意到 RpcContext 是线程绑定的，优雅的使用 TagRouter 特性，建议通过 servlet 过滤器(在 web 环境下)，或者定制的 SPI 过滤器设置 requestTag。</p>
</blockquote>
<h3 id="规则描述">规则描述</h3>
<ol>
<li>
<p>request.tag=red 时优先选择 tag=red 的 provider。若集群中不存在与请求标记对应的服务，可以降级请求 tag=null 的 provider，即默认 provider。</p>
</li>
<li>
<p>request.tag=null 时，只会匹配 tag=null 的 provider。即使集群中存在可用的服务，若 tag 不匹配就无法调用，这与规则1不同，携带标签的请求可以降级访问到无标签的服务，但不携带标签/携带其他种类标签的请求永远无法访问到其他标签的服务。</p>
</li>
</ol>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><code>2.2.0</code> 以上版本支持 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>路由规则扩展点：<a href="../../../dev/impls/router">路由扩展</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>注意：一个服务只能有一条白名单规则，否则两条规则交叉，就都被筛选掉了 <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>注意：脚本没有沙箱约束，可执行任意代码，存在后门风险 <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p>该特性在 <code>2.7.0</code> 以上版本支持 <a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

  
  
</div>


    </div>
    <div class="col-md-2">
    </div>
  </div>
  
</section>

  

<footer id="footer" role="contentinfo">
  <div class="container">
    <img src="/images/nacos_gray.png"/>
    <div class="row">
      <div class="col-md-6"><h3>愿景</h3>
        <p>Nacos 通过提供简单易用的动态服务发现、服务配置、服务共享与管理等服务基础设施，帮助用户在云原
            生时代，在私有云、混合云或者公有云等所有云环境中，更好的构建、交付、管理自己的微服务平台，更快的复用和组合业务服务，
            更快的交付商业创新的价值，从而为用户赢得市场。</p></div>
      <div class="col-md-3">
        <dl>
          <dt>文档</dt>
          
          <dd><a href="/en-us/docs/what-is-nacos.html" target="_self">概览</a></dd>
          
          <dd><a href="/en-us/docs/quick-start.html" target="_self">快速开始</a></dd>
          
          <dd><a href="/en-us/docs/contributing.html" target="_self">开发者指南</a></dd>
          
        </dl>
      </div>
      <div class="col-md-3">
        <dl>
          <dt>资源</dt>
          
          <dd><a href="/en-us/community/index.html" target="_self">社区</a></dd>
          
          <dd><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_self">云服务 MSE</a></dd>
          
          <dd><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self">云服务 EDAS</a></dd>
          
          <dd><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target="_self">云服务 AHAS</a></dd>
          
        </dl>
      </div>
    </div>
    <div class="col-md-12 text-center copyright">
      <span>© 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span>
    </div>
  </div>
</footer>


</body>
<script type="text/javascript">
  ;(function () {
    $('#fh5co-header').addClass('navbar-fixed-top fh5co-animated slideInDown');
    $('#nacosLogo').attr("src", "/images/nacos_colorful.png")
  }());
</script>
</html>